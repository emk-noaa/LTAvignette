<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 8 Line-transect analysis | User’s guide for LTabundR</title>
  <meta name="description" content="vignette" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content=" 8 Line-transect analysis | User’s guide for LTabundR" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="vignette" />
  <meta name="github-repo" content="emk-noaa/emk-noaa.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 8 Line-transect analysis | User’s guide for LTabundR" />
  
  <meta name="twitter:description" content="vignette" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="g0.html"/>
<link rel="next" href="destratify.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">WinCruz analysis</a></li>

<li class="divider"></li>
<li><a href="index.html#overview">Overview<span></span></a></li>
<li class="part"><span><b>I Data processing<span></span></b></span></li>
<li class="chapter" data-level="1" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>1</b> Install <code>LTabundR</code><span></span></a><ul>
<li><a href="install.html#option-1-install-from-github">Option 1: Install from GitHub<span></span></a></li>
<li><a href="install.html#option-2-install-locally">Option 2: Install locally<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="settings.html"><a href="settings.html"><i class="fa fa-check"></i><b>2</b> Settings<span></span></a><ul>
<li><a href="settings.html#survey-strata">Survey strata<span></span></a></li>
<li><a href="settings.html#survey-wide-settings">Survey-wide settings<span></span></a></li>
<li><a href="settings.html#cohort-specific-settings">Cohort-specific settings<span></span></a></li>
<li><a href="settings.html#example-code">Example code<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>3</b> Data processing<span></span></a><ul>
<li><a href="processing.html#behind-the-scenes">Behind the scenes<span></span></a></li>
<li><a href="processing.html#review">Review<span></span></a></li>
</ul></li>
<li class="part"><span><b>II Data exploration<span></span></b></span></li>
<li class="chapter" data-level="4" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>4</b> Maps<span></span></a><ul>
<li><a href="maps.html#publishable-maps">Publishable maps<span></span></a></li>
<li><a href="maps.html#interactive-maps">Interactive maps<span></span></a></li>
<li><a href="maps.html#interactive-dashboard">Interactive dashboard<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>5</b> Filter &amp; combine surveys<span></span></a><ul>
<li><a href="filter.html#filter-1">Filter<span></span></a></li>
<li><a href="filter.html#combine">Combine<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="summarize.html"><a href="summarize.html"><i class="fa fa-check"></i><b>6</b> Summarize survey<span></span></a><ul>
<li><a href="summarize.html#summarize-effort">Summarize effort<span></span></a></li>
<li><a href="summarize.html#summarize-by-beaufort">Summarize by Beaufort<span></span></a></li>
<li><a href="summarize.html#summarize-sightings">Summarize sightings<span></span></a></li>
<li><a href="summarize.html#summarize-certain-species">Summarize certain species<span></span></a></li>
<li><a href="summarize.html#cruz_explorer"><code>cruz_explorer()</code><span></span></a></li>
</ul></li>
<li class="part"><span><b>III Data analysis<span></span></b></span></li>
<li class="chapter" data-level="7" data-path="g0.html"><a href="g0.html"><i class="fa fa-check"></i><b>7</b> Estimating g(0)<span></span></a><ul>
<li><a href="g0.html#relative-g0">Relative <code>g(0)</code><span></span></a></li>
<li><a href="g0.html#weighted-average-g0">Weighted average <code>g(0)</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lta.html"><a href="lta.html"><i class="fa fa-check"></i><b>8</b> Line-transect analysis<span></span></a><ul>
<li><a href="lta.html#key-inputs">Key inputs<span></span></a></li>
<li><a href="lta.html#variance-estimation">Variance estimation<span></span></a></li>
<li><a href="lta.html#other-inputs">Other inputs<span></span></a></li>
<li><a href="lta.html#output">Output<span></span></a></li>
<li><a href="lta.html#unusual-estimate-scenarios">Unusual estimate scenarios<span></span></a></li>
<li><a href="lta.html#behind-the-scenes-1">Behind the scenes<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="destratify.html"><a href="destratify.html"><i class="fa fa-check"></i><b>9</b> Stratified analysis<span></span></a></li>
<li class="chapter" data-level="10" data-path="trend-analysis.html"><a href="trend-analysis.html"><i class="fa fa-check"></i><b>10</b> Trend analysis<span></span></a></li>
<li class="chapter" data-level="11" data-path="subgroup-based-analysis.html"><a href="subgroup-based-analysis.html"><i class="fa fa-check"></i><b>11</b> Subgroup-based analysis<span></span></a><ul>
<li><a href="subgroup-based-analysis.html#inputs-1">Inputs<span></span></a></li>
<li><a href="subgroup-based-analysis.html#outputs-1">Outputs<span></span></a></li>
<li><a href="subgroup-based-analysis.html#behind-the-scenes-2">Behind the scenes<span></span></a></li>
</ul></li>
<li class="part"><span><b>IV Results<span></span></b></span></li>
<li class="chapter" data-level="12" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>12</b> Tables<span></span></a><ul>
<li><a href="tables.html#summary-tables">Summary tables<span></span></a></li>
<li><a href="tables.html#appendix-tables">Appendix tables<span></span></a></li>
<li><a href="tables.html#abundance-plots">Abundance plots<span></span></a></li>
<li><a href="tables.html#detection-function-plots">Detection function plots<span></span></a></li>
</ul></li>
<li class="part"><span><b>V Case studies<span></span></b></span></li>
<li class="chapter" data-level="13" data-path="whiceas.html"><a href="whiceas.html"><i class="fa fa-check"></i><b>13</b> WHICEAS<span></span></a><ul>
<li><a href="whiceas.html#data-processing">Data processing<span></span></a></li>
<li><a href="whiceas.html#data-exploration">Data exploration<span></span></a></li>
<li><a href="whiceas.html#rg0-1">Rg0<span></span></a></li>
<li><a href="whiceas.html#density-abundance">Density &amp; abundance<span></span></a></li>
<li><a href="whiceas.html#results">Results<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case_cnp.html"><a href="case_cnp.html"><i class="fa fa-check"></i><b>14</b> Central North Pacific<span></span></a><ul>
<li><a href="case_cnp.html#data-processing-1">Data processing<span></span></a></li>
<li><a href="case_cnp.html#data-exploration-1">Data exploration<span></span></a></li>
<li><a href="case_cnp.html#rg0-2">Rg0<span></span></a></li>
<li><a href="case_cnp.html#density-abundance-1">Density &amp; abundance<span></span></a></li>
<li><a href="case_cnp.html#stratified-results">Stratified results<span></span></a></li>
<li><a href="case_cnp.html#de-stratified-results">De-stratified results<span></span></a></li>
<li><a href="case_cnp.html#plots-1">Plots<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="california-current-system.html"><a href="california-current-system.html"><i class="fa fa-check"></i><b>15</b> California Current System<span></span></a></li>
<li class="part"><span><b>VI Appendix<span></span></b></span><ul>
<li><a href="california-current-system.html#central-north-pacific">Central North Pacific<span></span></a></li>
<li><a href="california-current-system.html#california-current">California Current<span></span></a></li>
<li><a href="california-current-system.html#etp">ETP<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="segmentizing.html"><a href="segmentizing.html"><i class="fa fa-check"></i><b>16</b> Segmentizing<span></span></a><ul>
<li><a href="segmentizing.html#approach">Approach<span></span></a></li>
<li><a href="segmentizing.html#defaults-2">Defaults<span></span></a></li>
<li><a href="segmentizing.html#day-vs-equal-length">Day vs Equal Length<span></span></a></li>
<li><a href="segmentizing.html#contiguous-vs.-non-contiguous-effort">Contiguous vs. non-contiguous effort<span></span></a></li>
<li><a href="segmentizing.html#segment-remainder-handling">Segment remainder handling<span></span></a></li>
<li><a href="segmentizing.html#typical-settings">Typical settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="abund9_compare.html"><a href="abund9_compare.html"><i class="fa fa-check"></i><b>17</b> <code>LTabundR</code> vs. <code>ABUND9</code><span></span></a><ul>
<li><a href="abund9_compare.html#differences-in-total-effort">Differences in total effort<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-on-effort-distance">Differences in on-effort distance<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-total-sightings">Differences in total sightings<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-on-effort-sightings">Differences in on-effort sightings<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-school-size-estimation">Differences in school size estimation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="spp_codes.html"><a href="spp_codes.html"><i class="fa fa-check"></i><b>18</b> NOAA/NMFS species codes<span></span></a><ul>
<li><a href="spp_codes.html#table">Table<span></span></a></li>
<li><a href="spp_codes.html#species_translator"><code>species_translator()</code><span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/emk-noaa/emk-noaa.github.io" target="blank">Eric & Amanda</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">User’s guide for <code>LTabundR</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lta" class="section level1 hasAnchor">
<h1><span class="header-section-number"> 8</span> Line-transect analysis<a href="lta.html#lta" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We use line-transect analysis to produce estimates of animal density and/or abundance based upon surveys. The main <code>LTabundR</code> function for conducting line-transect analysis is <code>lta()</code>, which calls for four primary arguments in addition to your <code>cruz</code> object:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="lta.html#cb1-1"></a><span class="kw">lta</span>(cruz,</span>
<span id="cb1-2"><a href="lta.html#cb1-2"></a>    Rg0,</span>
<span id="cb1-3"><a href="lta.html#cb1-3"></a>    fit_filters,</span>
<span id="cb1-4"><a href="lta.html#cb1-4"></a>    df_settings,</span>
<span id="cb1-5"><a href="lta.html#cb1-5"></a>    estimates)</span></code></pre></div>
<p>Below we explain each of these inputs, discuss other optional inputs, and explore the results produced by <code>lta()</code>.</p>
<div id="key-inputs" class="section level2 unnumbered hasAnchor">
<h2>Key inputs<a href="lta.html#key-inputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="cruz" class="section level3 unnumbered hasAnchor">
<h3><code>cruz</code><a href="lta.html#cruz" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is the <code>cruz</code> object you have generated with <code>process_surveys()</code>. Before running <code>lta()</code>, ensure that this <code>cruz</code> object is filtered only to the years, regions, and sighting conditions you would like to use for detection function fitting. Filter your cruz object with full flexibility using <code>LTabundR::filter_cruz()</code>. Note that filtering for detection function fitting is typically less stringent than filtering for downstream steps for abundance estimation, since as many sightings are included as possible to combat low sample sizes, as long as sightings were observed using standard methods in an unbiased search pattern, and as long as you do not expect detectability to vary across years and regions.</p>
<p>Here we will work with a version of the 1986-2020 Central North Pacific survey data we processed a few pages back. This version is included as a built-in dataset within <code>LTabundR</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="lta.html#cb2-1"></a><span class="kw">load</span>(<span class="st">&#39;whiceas_cruz.RData&#39;</span>)</span></code></pre></div>
<p>As it is provided, this dataset does not need any filtering.</p>
<p>We will use these data to estimate the abundance of striped dolphins (<em>Stenella coeruleoalba</em>), Fraser’s dolphins (<em>Lagenodelphis hosei</em>), and Melon-headed whales (<em>Preponocephala electra</em>) within the WHICEAS study area in 2017 and 2020. We will group these three species into a ‘species pool’ in order to gain a sufficient sample size for fitting a detection function. We will then use “Species” as a covariate within the detection function model, along with other variables including Beaufort Sea State, ship name, and log-transformed school size.</p>
</div>
<div id="rg0" class="section level3 unnumbered hasAnchor">
<h3><code>Rg0</code><a href="lta.html#rg0" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The result of <code>LTabundR::g0_model()</code>, which is a <code>data.frame</code> with Relative trackline detection probabilities, <em>Rg(0)</em>, for each species in each Beaufort sea state. See <code>LTabundR</code> dataset <code>data("g0_results")</code>, used below, as an example.</p>
<p>This is an <em>optional</em> input. If not provided, <em>g(0)</em> will be assumed to 1.0, and its CV will be assumed to be 0. Alternatively, you can manually specify values for <em>g(0)</em> and its CV in the <code>estimates</code> argument below.</p>
<p>Here we will use a <code>data.frame</code> of <em>Rg(0)</em> estimates based on the same survey years, 1986 - 2020, which has been provided as a built-in dataset:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="lta.html#cb3-1"></a><span class="kw">data</span>(<span class="st">&quot;g0_results&quot;</span>)</span>
<span id="cb3-2"><a href="lta.html#cb3-2"></a>Rg0 &lt;-<span class="st"> </span>g0_results</span></code></pre></div>
</div>
<div id="fit_filters" class="section level3 unnumbered hasAnchor">
<h3><code>fit_filters</code><a href="lta.html#fit_filters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>fit_filters</code> input specifies how to filter the data before fitting the detection function. It accepts a named list, which in our example will look like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="lta.html#cb4-1"></a>fit_filters =<span class="st"> </span><span class="kw">list</span>(<span class="dt">spp =</span> <span class="kw">c</span>(<span class="st">&#39;013&#39;</span>, <span class="st">&#39;026&#39;</span>, <span class="st">&#39;031&#39;</span>), </span>
<span id="cb4-2"><a href="lta.html#cb4-2"></a>                   <span class="dt">pool =</span> <span class="st">&#39;Multi-species pool 1&#39;</span>,</span>
<span id="cb4-3"><a href="lta.html#cb4-3"></a>                   <span class="dt">cohort =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb4-4"><a href="lta.html#cb4-4"></a>                   <span class="dt">truncation_distance =</span> <span class="dv">5</span>,</span>
<span id="cb4-5"><a href="lta.html#cb4-5"></a>                   <span class="dt">other_species =</span> <span class="st">&#39;remove&#39;</span>)</span></code></pre></div>
<ul>
<li><p><strong><code>spp</code></strong>: A character vector of species codes. Using multiple species codes may be useful when you have low sample sizes for a cohort of similar species.</p></li>
<li><p><strong><code>cohort</code></strong>: The cohort containing these species, provided as a name or a number indicating which slot in <code>cruz$cohorts</code> should be referenced.</p></li>
<li><p><strong><code>truncation_distance</code></strong>: The truncation distance to apply during model fitting.</p></li>
</ul>
<p><em>The remaining inputs are optional (i.e., they all have defaults):</em></p>
<ul>
<li><p><strong><code>pool</code></strong>: A character string, providing a title for this species pool. If not specified, the species codes used will be concatenated to produce a title automatically.</p></li>
<li><p><strong><code>other_species</code></strong>: A character vector with four recognized values:</p>
<ul>
<li><font size="-1">If <code>"apply"</code> (the default if not specified), the species code will be changed to <code>"Other"</code> for sightings in which the species was in a mixed-species school but was not the species with the largest percentage of the total school size. In those cases, the species was not as relevant to the detection of the school as the other species were, which may bias the detection function. This creates a factor level for the detection function to use (when <code>"species"</code> is a covariate) to distinguish between cue-relevant species that are within the specified pool and those that are not.</font></li>
<li><font size="-1">The second option for <code>other_species</code> is <code>"ignore"</code>, which does <strong>not</strong> reassign species codes to <code>"Other"</code>, and ignores whether the species of interest held the plurality for a mixed species detection.</font></li>
<li><font size="-1">The third option is <code>"remove"</code>: any species re-assigned to <code>"Other"</code> will be removed before the detection function is fit; this can be useful if only a small number of species are re-assigned to <code>"Other"</code>, which would then obviate <code>species</code> as a viable covariate (since the sample size of all <code>species</code> levels would be unlikely to exceed <code>df_settings$covariates_n_per_level</code> – see below). </font></li>
<li><font size="-1">The fourth and final option is <code>coerce</code>, which forces <em>all</em> species codes to <code>"Other"</code> for the purposes of detection function fitting and abundance estimation. This is effectively the same as removing ‘species’ from the list of covariates, but this option can be a convenience if you want to quickly toggle the use of <code>species</code> as a covariate for a specific species pool, and/or produce abundance estimates for unidentified taxa (e.g., an ‘Unidentified dolphins’ species pool that includes multiple species codes).</font></li>
</ul></li>
</ul>
<p> </p>
</div>
<div id="df_settings" class="section level3 unnumbered hasAnchor">
<h3><code>df_settings</code><a href="lta.html#df_settings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>df_settings</code> input specifies how to fit a detection function to the filtered data. It accepts a named list, which in our example will look like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="lta.html#cb5-1"></a>df_settings =<span class="st"> </span><span class="kw">list</span>(<span class="dt">covariates =</span> <span class="kw">c</span>(<span class="st">&#39;bft&#39;</span>,<span class="st">&#39;lnsstot&#39;</span>,<span class="st">&#39;cruise&#39;</span>,<span class="st">&#39;year&#39;</span>,<span class="st">&#39;ship&#39;</span>,<span class="st">&#39;species&#39;</span>),</span>
<span id="cb5-2"><a href="lta.html#cb5-2"></a>                   <span class="dt">covariates_factor =</span> <span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>),</span>
<span id="cb5-3"><a href="lta.html#cb5-3"></a>                   <span class="dt">covariates_levels =</span> <span class="dv">2</span>,</span>
<span id="cb5-4"><a href="lta.html#cb5-4"></a>                   <span class="dt">covariates_n_per_level =</span> <span class="dv">10</span>,</span>
<span id="cb5-5"><a href="lta.html#cb5-5"></a>                   <span class="dt">detection_function_base =</span> <span class="st">&#39;hn&#39;</span>,</span>
<span id="cb5-6"><a href="lta.html#cb5-6"></a>                   <span class="dt">base_model =</span> <span class="st">&#39;~1&#39;</span>,</span>
<span id="cb5-7"><a href="lta.html#cb5-7"></a>                   <span class="dt">delta_aic =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><em>(Note that all of these inputs have defaults, and are therefore optional.)</em></p>
<ul>
<li><p><strong><code>covariates</code></strong> Covariates you wish to include as candidates in detection function models, provided as a character vector. The covariates must match columns existing within <code>cruz$cohorts$&lt;cohort_name&gt;$sightings</code>. Note that the function will ignore case, coercing all covariates to lowercase. Default: no covariates.</p></li>
<li><p><strong><code>covariates_factor</code></strong> A Boolean vector, which must be the same length as <code>covariates</code>, indicating whether each covariate should be treated as a factor instead of a numeric. Default: <code>NULL</code>.</p></li>
<li><p><strong><code>covariates_levels</code></strong> The minimum number of levels a factor covariate must have in order to be included as an eligible covariate. Default: <code>2</code>.</p></li>
<li><p><strong><code>covariates_n_per_level</code></strong> The minimum number of observations within each level of a factor covariate. If this condition is not met, the covariate is excluded from the candidates. Default: <code>10</code>.</p></li>
<li><p><strong><code>detection_function_base</code></strong> The base key for the detection function, provided as a character vector. Accepted values are <code>"hn"</code> (half-normal key, the default, which exhibits greater stability when fitting to cetacean survey data; Gerrogette and Forcada 2005), <code>"hr"</code> (hazard-rate), or <code>c("hn", "hr)</code>, which will loop through both keys and attempt model fitting.</p></li>
<li><p><strong><code>base_model</code></strong> The initial model formula, upon which to build using candidate covariates. If not provided by the user, the default is <code>"~ 1"</code>.</p></li>
<li><p><strong><code>delta_aic</code></strong> The AIC difference between the model yielding the lowest AIC and other candidate models, used to define the best-fitting models. Typically, AIC differences of less than 2 (the default) indicate effectively equal model performance. If this value is not zero, then model averaging will be done: if multiple models are within <code>delta_aic</code> of the model with the lowest AIC, all “best” models will be used in subsequent steps and their results will be averaged. See <code>Details</code> below.</p></li>
</ul>
</div>
<div id="estimates" class="section level3 unnumbered hasAnchor">
<h3><code>estimates</code><a href="lta.html#estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>estimates</code> input specifies which estimates of density and abundance to produce based on the fitted detection function. This input accepts a list of sub-lists, which in our example will look something like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="lta.html#cb6-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;013&#39;</span>,</span>
<span id="cb6-2"><a href="lta.html#cb6-2"></a>                       <span class="dt">title =</span> <span class="st">&#39;Striped dolphin&#39;</span>,</span>
<span id="cb6-3"><a href="lta.html#cb6-3"></a>                       <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb6-4"><a href="lta.html#cb6-4"></a>                       <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>))</span></code></pre></div>
<p>This example shows only a single sub-list, specifying how to generate a density/abundance estimate for striped dolphins (species code 013) within the “WHICEAS” geostratum for 2017.</p>
<ul>
<li><p><strong><code>spp</code></strong>: A character vector of species codes.</p></li>
<li><p><strong><code>title</code></strong>: A title for this abundance estimate, given as a character vector, ’ e.g., <code>"Striped dolphin - pelagic"</code>. If left blank, the species code(s) will be concatenated to use as a title.</p></li>
<li><p><strong><code>years</code></strong>: A numeric vector of years, used to filter data to include only effort/sightings from these years.</p></li>
<li><p><strong><code>regions</code></strong>: A character vector of geostratum names, used to filter the data. Any segment or sighting occurring within <em>any</em> (but <em>not</em> necessarily all) of the provided <code>regions</code> will be returned. This holds true for nested regions: for example, in analyses from the Central North Pacific, in which the Hawaii EEZ geostratum (<code>"HI-EEZ"</code>) is nested within the larger geostratum representing the entire CNP study area (<code>"OtherCNP"</code>), an input of <code>regions = "OtherCNP"</code> will return segments/sightings <em>both</em> inside the Hawaii EEZ <em>and</em> outside of it.</p></li>
</ul>
<p>You also have the option of manually specifying other filters &amp; arguments. Each of these sub-lists accepts the following named slots:</p>
<ul>
<li><p><strong><code>cruises</code></strong>: An optional numeric vector of cruise numbers, used to filter data to include effort/sighting from only certain cruises. Ignored if <code>NULL.</code></p></li>
<li><p><strong><code>regions_remove</code></strong>: A character vector of geostratum names, similar to above. Any segment or sighting occurring within any of these <code>not_regions</code> will <strong>not</strong> be returned. Using the example above, if <code>regions = "OtherCNP"</code> and <code>not_regions = "HI-EEZ"</code>, only segments occuring within <code>OtherCNP</code> <em>and</em> outside of <code>HI-EEZ</code> will be returned. This can be particularly useful for abundance estimates for pelagic stock that exclude nested insular stocks.</p></li>
<li><p><strong><code>g0</code></strong>: If left as the default <code>NULL</code>, the <code>lta()</code> function will automatically estimate the weighted trackline detection probability <em>(g0)</em> according to the distribution of Beaufort sea states contained within the survey years/regions for which density/abundance is being estimated (this is done using the <code>LTabundR</code> function <code>g0_weighted()</code>). This will only be done if the <code>Rg0</code> input above is not <code>NULL</code>; if it is and you do not provide <em>g(0)</em> values here, <code>g0</code> will be coerced to equal 1. To coerce <code>g(0)</code> to a certain value of your own choosing, you can provide a numeric vector of length 1 or 2. If length 1, this value represents <em>g(0)</em> for all schools regardless of size. If length 2, these values represent <em>g(0)</em> for small and large school sizes, as defined by <code>g0_threshold</code> below.</p></li>
<li><p><strong><code>g0_cv</code></strong>: Similar to g0 above: if left <code>NULL</code>, the CV of the <code>g(0)</code> estimate will be automatically estimated based on weighted survey conditions. Alternatively, you can manually specify a CV here, using a numeric vector of length 1 or 2. If you do not specify a value and <code>Rg0</code> input is NULL, <code>g0_cv</code> will be coerced to equal 0.</p></li>
<li><p><strong><code>g0_threshold</code></strong>: The school size threshold between small and large groups.</p></li>
<li><p><strong><code>alt_g0_spp</code></strong>: An alternate species code to use to draw Relative <em>g(0)</em> values from the <code>Rg0</code> input. This is useful in the event that <em>Rg(0)</em> was not estimated for the species whose density/abundance you are estimating, but there is a similarly detectable species whose <em>Rg(0)</em> parameters have been estimated.</p></li>
<li><p><strong><code>combine_g0</code></strong>: A Boolean, with default <code>FALSE</code>. If <code>TRUE</code>, weighted <em>g0</em> estimates will be produced separately for each species code provided (specifically, for each unique row in the <code>Rg0</code> table that is found after filtering by the species codes you provide in this estimate), <em>THEN</em> average those estimates together. This can be useful when you do not have a <em>Rg(0)</em> estimates for a certain species, but you can approximate <em>g0</em> by averaging together estimates from multiple species (e.g., averaging together weighted <em>g(0)</em> from across rorqual species in order to get a weighted <em>g(0)</em> estimate for ‘Unidentified rorquals’).</p></li>
<li><p><strong><code>region_title</code></strong>: An optional character vector indicating the title you would like to give to the region pertaining to this estimate. This can be useful if you have a complicated assemblage of regions you are combining and/or removing. If not supplied, the function will automatically generate a <code>region_title</code> based on <code>regions</code> and <code>regions_remove</code>.</p></li>
<li><p><strong><code>forced_effort</code></strong>: If this is a single numeric value instead of <code>NULL</code> (<code>NULL</code> is the default), this value will be used as the survey effort, in km, in a brute-force method; this same value will be used for every year and region. This is only helpful if you are looking for a relatively easy way to compare results from your own analysis to another (e.g., comparing <code>LTabundR</code> results to reports from NOAA reports prior to 2021, in which effort was calculated slightly differently).</p></li>
<li><p><strong><code>area</code></strong>: If this is a single numeric value instead of <code>NULL</code> (<code>NULL</code> is the default), this value will be used as the area of the region in which abundance is being estimated, in square km, in a brute-force approach. If left <code>NULL</code>, the function will calculate the final area of the survey area resulting from the regions and regions_remove filters above.</p></li>
<li><p><strong><code>remove_land</code></strong>: A Boolean, with default <code>TRUE</code>, indicating whether or not land area should be removed from the survey area before calculating its area for abundance estimation. This term is only referenced if area is not specified manually.</p></li>
</ul>
<p>Here is the full <code>estimates</code> list for all the species-year-geostratum combinations for which we want to estimate density/abundance:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="lta.html#cb7-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb7-2"><a href="lta.html#cb7-2"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;013&#39;</span>,</span>
<span id="cb7-3"><a href="lta.html#cb7-3"></a>         <span class="dt">title =</span> <span class="st">&#39;Striped dolphin&#39;</span>,</span>
<span id="cb7-4"><a href="lta.html#cb7-4"></a>         <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb7-5"><a href="lta.html#cb7-5"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb7-6"><a href="lta.html#cb7-6"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;013&#39;</span>,</span>
<span id="cb7-7"><a href="lta.html#cb7-7"></a>         <span class="dt">title =</span> <span class="st">&#39;Striped dolphin&#39;</span>,</span>
<span id="cb7-8"><a href="lta.html#cb7-8"></a>         <span class="dt">years =</span> <span class="dv">2020</span>,</span>
<span id="cb7-9"><a href="lta.html#cb7-9"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb7-10"><a href="lta.html#cb7-10"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;026&#39;</span>,</span>
<span id="cb7-11"><a href="lta.html#cb7-11"></a>         <span class="dt">title =</span> <span class="st">&#39;Frasers dolphin&#39;</span>,</span>
<span id="cb7-12"><a href="lta.html#cb7-12"></a>         <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb7-13"><a href="lta.html#cb7-13"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb7-14"><a href="lta.html#cb7-14"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;026&#39;</span>,</span>
<span id="cb7-15"><a href="lta.html#cb7-15"></a>         <span class="dt">title =</span> <span class="st">&#39;Frasers dolphin&#39;</span>,</span>
<span id="cb7-16"><a href="lta.html#cb7-16"></a>         <span class="dt">years =</span> <span class="dv">2020</span>,</span>
<span id="cb7-17"><a href="lta.html#cb7-17"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb7-18"><a href="lta.html#cb7-18"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;031&#39;</span>,</span>
<span id="cb7-19"><a href="lta.html#cb7-19"></a>         <span class="dt">title =</span> <span class="st">&#39;Melon-headed whale&#39;</span>,</span>
<span id="cb7-20"><a href="lta.html#cb7-20"></a>         <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb7-21"><a href="lta.html#cb7-21"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb7-22"><a href="lta.html#cb7-22"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;031&#39;</span>,</span>
<span id="cb7-23"><a href="lta.html#cb7-23"></a>         <span class="dt">title =</span> <span class="st">&#39;Melon-headed whale&#39;</span>,</span>
<span id="cb7-24"><a href="lta.html#cb7-24"></a>         <span class="dt">years =</span> <span class="dv">2020</span>,</span>
<span id="cb7-25"><a href="lta.html#cb7-25"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>))</span></code></pre></div>
<p>Each of these sub-lists specifies the details for a single estimate of density/abundance, making it possible to produce multiple estimates from the same detection function model. Generally, there needs to be a sub-list for each species-region-year combination of interest.</p>
<p>You can imagine that building up these sub-lists can get tedious. It can also introduce the possibility of error or inconsistencies across estimates of multiple species. To address that issue, <code>LTabundR</code> includes the function <code>lta_estimates()</code>, which makes your code for preparing an <code>estimates</code> object much more efficient. That function is demonstrated in the Case Studies chapters.</p>
<p>Quickly review results:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="lta.html#cb8-1"></a>results<span class="op">$</span>estimate</span>
<span id="cb8-2"><a href="lta.html#cb8-2"></a><span class="co">##                title species    Region     Area year segments       km</span></span>
<span id="cb8-3"><a href="lta.html#cb8-3"></a><span class="co">## 1    Striped dolphin     013 (WHICEAS) 402948.7 2017       29 3040.009</span></span>
<span id="cb8-4"><a href="lta.html#cb8-4"></a><span class="co">## 2    Striped dolphin     013 (WHICEAS) 402948.7 2020       34 4585.386</span></span>
<span id="cb8-5"><a href="lta.html#cb8-5"></a><span class="co">## 3    Frasers dolphin     026 (WHICEAS) 402948.7 2017       29 3040.009</span></span>
<span id="cb8-6"><a href="lta.html#cb8-6"></a><span class="co">## 4    Frasers dolphin     026 (WHICEAS) 402948.7 2020       34 4585.386</span></span>
<span id="cb8-7"><a href="lta.html#cb8-7"></a><span class="co">## 5 Melon-headed whale     031 (WHICEAS) 402948.7 2017       29 3040.009</span></span>
<span id="cb8-8"><a href="lta.html#cb8-8"></a><span class="co">## 6 Melon-headed whale     031 (WHICEAS) 402948.7 2020       34 4585.386</span></span>
<span id="cb8-9"><a href="lta.html#cb8-9"></a><span class="co">##   Area_covered ESW_mean n g0_est  ER_clusters   D_clusters N_clusters size_mean</span></span>
<span id="cb8-10"><a href="lta.html#cb8-10"></a><span class="co">## 1    11003.442 3.619543 3  0.510 0.0009868393 0.0002691926  108.47080  31.95079</span></span>
<span id="cb8-11"><a href="lta.html#cb8-11"></a><span class="co">## 2    16960.781 3.698878 3  0.483 0.0006542525 0.0001844374   74.31882  53.95865</span></span>
<span id="cb8-12"><a href="lta.html#cb8-12"></a><span class="co">## 3           NA       NA 0  0.443 0.0000000000 0.0000000000    0.00000        NA</span></span>
<span id="cb8-13"><a href="lta.html#cb8-13"></a><span class="co">## 4    16897.976 3.685181 2  0.413 0.0004361683 0.0001437420   57.92064 132.51143</span></span>
<span id="cb8-14"><a href="lta.html#cb8-14"></a><span class="co">## 5     9538.118 3.137530 2  0.580 0.0006578929 0.0001819372   73.31137 185.98103</span></span>
<span id="cb8-15"><a href="lta.html#cb8-15"></a><span class="co">## 6    15957.100 3.479991 3  0.556 0.0006542525 0.0001706628   68.76837 226.13289</span></span>
<span id="cb8-16"><a href="lta.html#cb8-16"></a><span class="co">##       size_sd         ER           D         N</span></span>
<span id="cb8-17"><a href="lta.html#cb8-17"></a><span class="co">## 1   0.5780968 0.03153029 0.008611828  3470.125</span></span>
<span id="cb8-18"><a href="lta.html#cb8-18"></a><span class="co">## 2   2.7402089 0.03530258 0.009945862  4007.673</span></span>
<span id="cb8-19"><a href="lta.html#cb8-19"></a><span class="co">## 3          NA 0.00000000 0.000000000     0.000</span></span>
<span id="cb8-20"><a href="lta.html#cb8-20"></a><span class="co">## 4 182.1747087 0.05779729 0.018008943  7256.681</span></span>
<span id="cb8-21"><a href="lta.html#cb8-21"></a><span class="co">## 5  96.4369707 0.12235559 0.032840131 13232.889</span></span>
<span id="cb8-22"><a href="lta.html#cb8-22"></a><span class="co">## 6 175.5620746 0.14794801 0.040204435 16200.326</span></span></code></pre></div>
<p>More details on the <code>lta()</code> output are provided below.</p>
</div>
</div>
<div id="variance-estimation" class="section level2 unnumbered hasAnchor">
<h2>Variance estimation<a href="lta.html#variance-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By default, the <code>lta()</code> function produces a single estimate of the detection function and a single estimate of density/abundance estimate for each sub-list within <code>estimates()</code>. However, you can obtain the coefficient of variation (CV) of those estimates by activating the function’s bootstrap variance estimation feature. To do this, add <code>bootstraps</code> as an input specifying a large number of iterations (1,000 iterations is standard, but we suggest first testing your code with 5 - 10 bootstraps before committing; the function typically requires ~1 hour per 100 bootstraps.).</p>
<p>For the purposes of example only, we will just use 10 bootstrap iterations here:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="lta.html#cb9-1"></a>results &lt;-<span class="st"> </span><span class="kw">lta</span>(cruz, Rg0,</span>
<span id="cb9-2"><a href="lta.html#cb9-2"></a>               fit_filters, df_settings, estimates,</span>
<span id="cb9-3"><a href="lta.html#cb9-3"></a>               <span class="dt">bootstraps =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>This command will first produce official estimates of the detection function and density/abundance, then it will repeat the analysis for the number of iterations you have specified. In each iteration, survey segments are re-sampled according to standard bootstrap variance estimation methods (see more details below, in “Behind the Scenes”).</p>
</div>
<div id="other-inputs" class="section level2 unnumbered hasAnchor">
<h2>Other inputs<a href="lta.html#other-inputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are a few other optional input arguments that lend further control over the <code>lta()</code> procedure.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="lta.html#cb10-1"></a><span class="kw">lta</span>(cruz,</span>
<span id="cb10-2"><a href="lta.html#cb10-2"></a>    Rg0,</span>
<span id="cb10-3"><a href="lta.html#cb10-3"></a>    fit_filters,</span>
<span id="cb10-4"><a href="lta.html#cb10-4"></a>    df_settings,</span>
<span id="cb10-5"><a href="lta.html#cb10-5"></a>    estimates,</span>
<span id="cb10-6"><a href="lta.html#cb10-6"></a>    <span class="dt">use_g0 =</span> <span class="ot">TRUE</span>,</span>
<span id="cb10-7"><a href="lta.html#cb10-7"></a>    <span class="dt">ss_correction =</span> <span class="dv">1</span>,</span>
<span id="cb10-8"><a href="lta.html#cb10-8"></a>    <span class="dt">bootstraps =</span> <span class="dv">10</span></span>
<span id="cb10-9"><a href="lta.html#cb10-9"></a>    <span class="dt">toplot =</span> <span class="ot">TRUE</span>,</span>
<span id="cb10-10"><a href="lta.html#cb10-10"></a>    <span class="dt">verbose =</span> <span class="ot">TRUE</span>,)</span></code></pre></div>
<ul>
<li><p><strong><code>use_g0</code></strong>: A Boolean, with default <code>TRUE</code>, indicating whether or not to use custom <code>g(0)</code> value(s). If <code>FALSE</code>, the assumed <code>g(0)</code> value will be 1. This is an easy way to toggle on-and-off automated <em>g(0)</em> estimation and/or ignore manually supplied <em>g(0)</em> values.</p></li>
<li><p><strong><code>ss_correction</code></strong>: Should a correction be applied to school sizes? School sizes will be scaled by this number. The default, <code>1</code>, means no changes will occur.</p></li>
<li><p><strong><code>toplot</code></strong>: A Boolean, with default <code>TRUE</code>, indicating whether detection function plots (<code>Distance::plot.ds()</code>) should be displayed as the candidate models are tested.</p></li>
<li><p><strong><code>verbose</code></strong>: A Boolean, with default <code>TRUE</code>, indicating whether or not updates should be printed to the Console.</p></li>
</ul>
</div>
<div id="output" class="section level2 unnumbered hasAnchor">
<h2>Output<a href="lta.html#output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="during-processing" class="section level3 unnumbered hasAnchor">
<h3>During processing<a href="lta.html#during-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While <code>lta()</code> is running, it will print things to the Console (if <code>verbose</code> is <code>TRUE</code>), plot diagnostic plots of how the study area is being calculated (if <code>toplot</code> is <code>TRUE</code>), and plot detection function model candidates (if <code>toplot</code> is <code>TRUE</code>). To demonstrate this, we will run the estimate for striped dolphins in 2017 only, without variance bootstrapping. To expedite processing, we will manually supply <em>g(0)</em> values from Bradford et al. (2021) (this saves about 3 minutes per estimate):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="lta.html#cb11-1"></a>new_estimates &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb11-2"><a href="lta.html#cb11-2"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;013&#39;</span>,</span>
<span id="cb11-3"><a href="lta.html#cb11-3"></a>         <span class="dt">title =</span> <span class="st">&#39;Striped dolphin&#39;</span>,</span>
<span id="cb11-4"><a href="lta.html#cb11-4"></a>         <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb11-5"><a href="lta.html#cb11-5"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>,</span>
<span id="cb11-6"><a href="lta.html#cb11-6"></a>         <span class="dt">g0 =</span> <span class="fl">0.35</span>, <span class="dt">g0_cv =</span> <span class="fl">0.19</span>))</span>
<span id="cb11-7"><a href="lta.html#cb11-7"></a></span>
<span id="cb11-8"><a href="lta.html#cb11-8"></a><span class="co"># Run it:</span></span>
<span id="cb11-9"><a href="lta.html#cb11-9"></a>demo &lt;-<span class="st"> </span><span class="kw">lta</span>(cruz, Rg0, fit_filters, df_settings, new_estimates)</span>
<span id="cb11-10"><a href="lta.html#cb11-10"></a><span class="co">## </span></span>
<span id="cb11-11"><a href="lta.html#cb11-11"></a><span class="co">## Reviewing `estimates` sublists and filling in any unspecified parameters ...</span></span>
<span id="cb11-12"><a href="lta.html#cb11-12"></a><span class="co">## --- estimate sub-list 1 :: Striped dolphin</span></span>
<span id="cb11-13"><a href="lta.html#cb11-13"></a><span class="co">## --- --- building survey area polygon given `regions` and `regions_remove` specs ...</span></span>
<span id="cb11-14"><a href="lta.html#cb11-14"></a><span class="co">## --- --- --- getting area of this polygon to use as abundance estimation area ...</span></span>
<span id="cb11-15"><a href="lta.html#cb11-15"></a><span class="co">## --- --- handling g(0) parameters ....</span></span>
<span id="cb11-16"><a href="lta.html#cb11-16"></a><span class="co">## </span></span>
<span id="cb11-17"><a href="lta.html#cb11-17"></a><span class="co">## Preparing a table of g(0) parameters for this set of estimates ...</span></span>
<span id="cb11-18"><a href="lta.html#cb11-18"></a><span class="co">## --- g(0) estimate: par1 = -0.63414 | par2 = 0.29679 | mean = 0.34878 | CV = 0.19058</span></span>
<span id="cb11-19"><a href="lta.html#cb11-19"></a><span class="co">## </span></span>
<span id="cb11-20"><a href="lta.html#cb11-20"></a><span class="co">## Filtering data according to `fit_filter` ...</span></span>
<span id="cb11-21"><a href="lta.html#cb11-21"></a><span class="co">## --- --- Segments: 1888</span></span>
<span id="cb11-22"><a href="lta.html#cb11-22"></a><span class="co">## --- --- Sightings: 407</span></span>
<span id="cb11-23"><a href="lta.html#cb11-23"></a><span class="co">## </span></span>
<span id="cb11-24"><a href="lta.html#cb11-24"></a><span class="co">## Handling &quot;Other&quot; species designations ...</span></span>
<span id="cb11-25"><a href="lta.html#cb11-25"></a><span class="co">## </span></span>
<span id="cb11-26"><a href="lta.html#cb11-26"></a><span class="co">## Removing rows with invalid numeric covariate data from the detection-function-fitting dataset: ***</span></span>
<span id="cb11-27"><a href="lta.html#cb11-27"></a><span class="co">##     Cruise            DateTime SightNoDaily line_num species Bft  lnsstot</span></span>
<span id="cb11-28"><a href="lta.html#cb11-28"></a><span class="co">## 41    1164 1988-08-08 08:05:00   19880808_9    41585     026  NA 6.856462</span></span>
<span id="cb11-29"><a href="lta.html#cb11-29"></a><span class="co">## 72    1268 1989-08-23 17:45:00  19890823_12    60352     013  NA 2.995732</span></span>
<span id="cb11-30"><a href="lta.html#cb11-30"></a><span class="co">## 82    1268 1989-11-25 06:10:00  19891125_22    66719     013  NA 4.716132</span></span>
<span id="cb11-31"><a href="lta.html#cb11-31"></a><span class="co">## 387   2001 2020-01-26 07:51:40 20200126_129   609065     013  NA 3.676782</span></span>
<span id="cb11-32"><a href="lta.html#cb11-32"></a><span class="co">## </span></span>
<span id="cb11-33"><a href="lta.html#cb11-33"></a><span class="co">## Removing rows with invalid school size estimates from the detection-function-fitting dataset: ***</span></span>
<span id="cb11-34"><a href="lta.html#cb11-34"></a><span class="co">##     Cruise            DateTime SightNoDaily line_num species best ss_valid</span></span>
<span id="cb11-35"><a href="lta.html#cb11-35"></a><span class="co">## 334   1604 2016-07-07 07:15:57 20160707_105   512744   Other    1    FALSE</span></span>
<span id="cb11-36"><a href="lta.html#cb11-36"></a><span class="co">## </span></span>
<span id="cb11-37"><a href="lta.html#cb11-37"></a><span class="co">## Preparing sample size table ...</span></span>
<span id="cb11-38"><a href="lta.html#cb11-38"></a><span class="co">## </span></span>
<span id="cb11-39"><a href="lta.html#cb11-39"></a><span class="co">## Inventorying covariate factors ...</span></span>
<span id="cb11-40"><a href="lta.html#cb11-40"></a><span class="co">## --- covariates that will be used in detection function fitting:</span></span>
<span id="cb11-41"><a href="lta.html#cb11-41"></a><span class="co">##     bft, lnsstot, ship, species</span></span>
<span id="cb11-42"><a href="lta.html#cb11-42"></a><span class="co">## </span></span>
<span id="cb11-43"><a href="lta.html#cb11-43"></a><span class="co">## ___________________________________________</span></span>
<span id="cb11-44"><a href="lta.html#cb11-44"></a><span class="co">## Estimating the detection function ...</span></span>
<span id="cb11-45"><a href="lta.html#cb11-45"></a><span class="co">## Step-wise model fitting of detection function...</span></span>
<span id="cb11-46"><a href="lta.html#cb11-46"></a><span class="co">## </span></span>
<span id="cb11-47"><a href="lta.html#cb11-47"></a><span class="co">## Key: hn :: Fitting base model ...</span></span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-1.png" width="576" /></p>
<pre><code>##      AIC = 1066.289 | Pmean = 0.576
## Key: hn :: Step 1 :: Covariate 1 :: Formula ::  ~1 + bft</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-2.png" width="576" /></p>
<pre><code>##      AIC = 1062.958 | Pmean = 0.572
## Key: hn :: Step 1 :: Covariate 2 :: Formula ::  ~1 + lnsstot</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-3.png" width="576" /></p>
<pre><code>##      AIC = 1064.352 | Pmean = 0.573
## Key: hn :: Step 1 :: Covariate 3 :: Formula ::  ~1 + ship</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-4.png" width="576" /></p>
<pre><code>##      AIC = 1054.178 | Pmean = 0.558
## Key: hn :: Step 1 :: Covariate 4 :: Formula ::  ~1 + species</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-5.png" width="576" /></p>
<pre><code>##      AIC = 1069.403 | Pmean = 0.575
## Key: hn :: Step 2 :: Covariate 1 :: Formula ::  ~1 + ship + bft</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-6.png" width="576" /></p>
<pre><code>##      AIC = 1044.227 | Pmean = 0.547
## Key: hn :: Step 2 :: Covariate 2 :: Formula ::  ~1 + ship + lnsstot</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-7.png" width="576" /></p>
<pre><code>##      AIC = 1050.053 | Pmean = 0.552
## Key: hn :: Step 2 :: Covariate 4 :: Formula ::  ~1 + ship + species</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-8.png" width="576" /></p>
<pre><code>##      AIC = 1057.603 | Pmean = 0.557
## Key: hn :: Step 3 :: Covariate 2 :: Formula ::  ~1 + ship + bft + lnsstot</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-9.png" width="576" /></p>
<pre><code>##      AIC = 1042.481 | Pmean = 0.543
## Key: hn :: Step 3 :: Covariate 4 :: Formula ::  ~1 + ship + bft + species</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-10.png" width="576" /></p>
<pre><code>##      AIC = 1044.467 | Pmean = 0.543
## Key: hn :: Step 4 :: Covariate 4 :: Formula ::  ~1 + ship + bft + lnsstot + species</code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-11.png" width="576" /></p>
<pre><code>##      AIC = 1041.309 | Pmean = 0.536
## 
## Preparing model comparison tables...
## Averaging each sighting ESW across top-candidate detection functions ...
## 
## ___________________________________________
## Estimating density &amp; abundance ...
## --- --- Filtering data according to `estimates` input ...
## --- --- Segments: 29
## --- --- Sightings: 3
## --- --- Staging g0 values ...
## --- --- Calcluating density and abundance for various region-year combinations ...
## </code></pre>
<p><img src="vignette_files/figure-html/unnamed-chunk-17-12.png" width="576" /></p>
<p>Additionally, windows will appear showing details for the detection function models and details of the density/abundance estimate.</p>
</div>
<div id="outputs" class="section level3 unnumbered hasAnchor">
<h3>Outputs<a href="lta.html#outputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>lta()</code> function returns a list of objects. To demonstrate this output, we will pull back in the dataset representing the result of the analysis above, for all three species in both years (with 5 bootstrap iterations):</p>
<p>This list of results has five slots:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="lta.html#cb23-1"></a><span class="kw">names</span>(results)</span>
<span id="cb23-2"><a href="lta.html#cb23-2"></a><span class="co">## [1] &quot;pool&quot;      &quot;inputs&quot;    &quot;estimate&quot;  &quot;df&quot;        &quot;bootstrap&quot;</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><strong><code>pool</code></strong>: The species pool pertaining to these estimates.</p></li>
<li><p><strong><code>inputs</code></strong>: A list of the inputs used to produce these estimates.</p></li>
<li><p><strong><code>estimate</code></strong>: A table of density/abundance estimates for each species/region/year combination specified in the <code>estimates</code> input.</p></li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="lta.html#cb24-1"></a>results<span class="op">$</span>estimate</span>
<span id="cb24-2"><a href="lta.html#cb24-2"></a><span class="co">##                title species    Region     Area year segments       km</span></span>
<span id="cb24-3"><a href="lta.html#cb24-3"></a><span class="co">## 1    Striped dolphin     013 (WHICEAS) 402948.7 2017       29 3040.009</span></span>
<span id="cb24-4"><a href="lta.html#cb24-4"></a><span class="co">## 2    Striped dolphin     013 (WHICEAS) 402948.7 2020       34 4585.386</span></span>
<span id="cb24-5"><a href="lta.html#cb24-5"></a><span class="co">## 3    Frasers dolphin     026 (WHICEAS) 402948.7 2017       29 3040.009</span></span>
<span id="cb24-6"><a href="lta.html#cb24-6"></a><span class="co">## 4    Frasers dolphin     026 (WHICEAS) 402948.7 2020       34 4585.386</span></span>
<span id="cb24-7"><a href="lta.html#cb24-7"></a><span class="co">## 5 Melon-headed whale     031 (WHICEAS) 402948.7 2017       29 3040.009</span></span>
<span id="cb24-8"><a href="lta.html#cb24-8"></a><span class="co">## 6 Melon-headed whale     031 (WHICEAS) 402948.7 2020       34 4585.386</span></span>
<span id="cb24-9"><a href="lta.html#cb24-9"></a><span class="co">##   Area_covered ESW_mean n g0_est  ER_clusters   D_clusters N_clusters size_mean</span></span>
<span id="cb24-10"><a href="lta.html#cb24-10"></a><span class="co">## 1    11003.442 3.619543 3  0.512 0.0009868393 0.0002681410  108.04709  31.95079</span></span>
<span id="cb24-11"><a href="lta.html#cb24-11"></a><span class="co">## 2    16960.781 3.698878 3  0.485 0.0006542525 0.0001836769   74.01235  53.95865</span></span>
<span id="cb24-12"><a href="lta.html#cb24-12"></a><span class="co">## 3           NA       NA 0  0.446 0.0000000000 0.0000000000    0.00000        NA</span></span>
<span id="cb24-13"><a href="lta.html#cb24-13"></a><span class="co">## 4    16897.976 3.685181 2  0.410 0.0004361683 0.0001447937   58.34445 132.51143</span></span>
<span id="cb24-14"><a href="lta.html#cb24-14"></a><span class="co">## 5     9538.118 3.137530 2  0.583 0.0006578929 0.0001810010   72.93413 185.98103</span></span>
<span id="cb24-15"><a href="lta.html#cb24-15"></a><span class="co">## 6    15957.100 3.479991 3  0.557 0.0006542525 0.0001703564   68.64490 226.13289</span></span>
<span id="cb24-16"><a href="lta.html#cb24-16"></a><span class="co">##       size_sd         ER           D         N</span></span>
<span id="cb24-17"><a href="lta.html#cb24-17"></a><span class="co">## 1   0.5780968 0.03153029 0.008578188  3456.570</span></span>
<span id="cb24-18"><a href="lta.html#cb24-18"></a><span class="co">## 2   2.7402089 0.03530258 0.009904849  3991.146</span></span>
<span id="cb24-19"><a href="lta.html#cb24-19"></a><span class="co">## 3          NA 0.00000000 0.000000000     0.000</span></span>
<span id="cb24-20"><a href="lta.html#cb24-20"></a><span class="co">## 4 182.1747087 0.05779729 0.018140716  7309.778</span></span>
<span id="cb24-21"><a href="lta.html#cb24-21"></a><span class="co">## 5  96.4369707 0.12235559 0.032671143 13164.796</span></span>
<span id="cb24-22"><a href="lta.html#cb24-22"></a><span class="co">## 6 175.5620746 0.14794801 0.040132254 16171.241</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><strong><code>df</code></strong>: A named list with details for the detection function.</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="lta.html#cb25-1"></a>results<span class="op">$</span>df <span class="op">%&gt;%</span><span class="st"> </span>names</span>
<span id="cb25-2"><a href="lta.html#cb25-2"></a><span class="co">## [1] &quot;best_models&quot;  &quot;all_models&quot;   &quot;best_objects&quot; &quot;sightings&quot;    &quot;sample_size&quot; </span></span>
<span id="cb25-3"><a href="lta.html#cb25-3"></a><span class="co">## [6] &quot;curve&quot;</span></span>
<span id="cb25-4"><a href="lta.html#cb25-4"></a></span>
<span id="cb25-5"><a href="lta.html#cb25-5"></a>results<span class="op">$</span>df<span class="op">$</span>best_models</span>
<span id="cb25-6"><a href="lta.html#cb25-6"></a><span class="co">##   Model Key_function                             Formula     Pmean      AIC</span></span>
<span id="cb25-7"><a href="lta.html#cb25-7"></a><span class="co">## 1    11           hn ~1 + ship + bft + lnsstot + species 0.5357372 1041.309</span></span>
<span id="cb25-8"><a href="lta.html#cb25-8"></a><span class="co">## 2     9           hn           ~1 + ship + bft + lnsstot 0.5431524 1042.481</span></span>
<span id="cb25-9"><a href="lta.html#cb25-9"></a><span class="co">##   $\\Delta$AIC           Covariates tested                 pool</span></span>
<span id="cb25-10"><a href="lta.html#cb25-10"></a><span class="co">## 1        0.000 bft, lnsstot, ship, species Multi-species pool 1</span></span>
<span id="cb25-11"><a href="lta.html#cb25-11"></a><span class="co">## 2        1.172 bft, lnsstot, ship, species Multi-species pool 1</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><strong><code>bootstrap</code></strong>: If bootstrap variance estimation was carried out, the output would also include <code>bootstrap</code>, a named list with results from the bootstrap process, only returned if the bootstraps input is greater than 1.</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="lta.html#cb26-1"></a>results<span class="op">$</span>bootstrap <span class="op">%&gt;%</span><span class="st"> </span>names</span>
<span id="cb26-2"><a href="lta.html#cb26-2"></a><span class="co">## [1] &quot;summary&quot; &quot;details&quot; &quot;df&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="lta.html#cb27-1"></a>results<span class="op">$</span>bootstrap<span class="op">$</span>summary <span class="op">%&gt;%</span><span class="st"> </span>head</span>
<span id="cb27-2"><a href="lta.html#cb27-2"></a><span class="co">## # A tibble: 6 × 18</span></span>
<span id="cb27-3"><a href="lta.html#cb27-3"></a><span class="co">## # Groups:   title, Region [3]</span></span>
<span id="cb27-4"><a href="lta.html#cb27-4"></a><span class="co">##   title      Region year  species iterations ESW_mean g0_mean g0_cv    km     ER</span></span>
<span id="cb27-5"><a href="lta.html#cb27-5"></a><span class="co">##   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb27-6"><a href="lta.html#cb27-6"></a><span class="co">## 1 Frasers d… (WHIC… 2017  026             10   NaN      0.454 0.777 3030. 0     </span></span>
<span id="cb27-7"><a href="lta.html#cb27-7"></a><span class="co">## 2 Frasers d… (WHIC… 2020  026             10     3.44   0.482 0.763 4427. 0.0615</span></span>
<span id="cb27-8"><a href="lta.html#cb27-8"></a><span class="co">## 3 Melon-hea… (WHIC… 2017  031             10     3.02   0.628 0.409 3030. 0.144 </span></span>
<span id="cb27-9"><a href="lta.html#cb27-9"></a><span class="co">## 4 Melon-hea… (WHIC… 2020  031             10     3.26   0.633 0.417 4427. 0.205 </span></span>
<span id="cb27-10"><a href="lta.html#cb27-10"></a><span class="co">## 5 Striped d… (WHIC… 2017  013             10     3.49   0.479 0.144 3030. 0.0406</span></span>
<span id="cb27-11"><a href="lta.html#cb27-11"></a><span class="co">## 6 Striped d… (WHIC… 2020  013             10     3.37   0.499 0.184 4427. 0.0502</span></span>
<span id="cb27-12"><a href="lta.html#cb27-12"></a><span class="co">## # … with 8 more variables: D &lt;dbl&gt;, size &lt;dbl&gt;, Nmean &lt;dbl&gt;, Nmedian &lt;dbl&gt;,</span></span>
<span id="cb27-13"><a href="lta.html#cb27-13"></a><span class="co">## #   Nsd &lt;dbl&gt;, CV &lt;dbl&gt;, L95 &lt;dbl&gt;, U95 &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
<div id="unusual-estimate-scenarios" class="section level2 unnumbered hasAnchor">
<h2>Unusual estimate scenarios<a href="lta.html#unusual-estimate-scenarios" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most line-transect estimates in most areas are relatively straightforward: you want an estimate for a single species in a single year, and your geostrata do not overlap, nor do they need to be stratified or combined in funny ways.</p>
<p>But there will also be unusual and slightly more complicated scenarios. We outline some of those below and demonstrate how they can be handled within the <code>LTabundR</code> framework.</p>
<div id="species-combinations-g0" class="section level3 unnumbered hasAnchor">
<h3>Species combinations &amp; <em>g(0)</em><a href="lta.html#species-combinations-g0" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="multi-species-schools" class="section level4 unnumbered hasAnchor">
<h4>Multi-species schools<a href="lta.html#multi-species-schools" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Multi-species schools can confound detection function model fitting, since your species of interest may not be the predominant species in the group, which means that the other species present may be having a greater influence over the detection function. You can decide how to account for this using the <code>other_species</code> slot in your <code>fit_filters</code> list. See the details on this discussed above.</p>
</div>
<div id="species-pools" class="section level4 unnumbered hasAnchor">
<h4>Species pools<a href="lta.html#species-pools" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When you don’t have enough sightings of individual species to model a detection function effectively, it can be useful to pool sightings from multiple species who have similar detection characteristics. This is a common tactic in the Central North Pacific.</p>
<p>When you do this, you typically need to make the following changes to a “normal” <code>lta()</code> call:</p>
<ol style="list-style-type: decimal">
<li><p>In your <code>df_settings</code> list, consider adding <code>species</code> as a covariate, and ensure that you specify that it should be treated as a factor. This may improve detection function model fit.</p></li>
<li><p>In your <code>fit_filters</code> list, specify multiple species codes and name your species pool accordingly (e.g., “Multi-species pool 1”).</p></li>
<li><p>In your <code>fit_filters</code> list, specify how to handle “Other” species (see above).</p></li>
<li><p>In your <code>estimates</code> list, add a sub-list for each species-region-year for which you want a density/abundance estimate.</p></li>
</ol>
<p>We took all of these steps in the example above with striped dolphins, Fraser’s dolphins, and melon-headed whales. Use that code as a guide.</p>
</div>
<div id="pooling-similar-species" class="section level4 unnumbered hasAnchor">
<h4>Pooling similar species<a href="lta.html#pooling-similar-species" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Species that can be confused with one another may need to be pooled together for abundance estimation. For example, in the northeast Pacific, sei whales, Bryde’s whales, and fin whales can co-occur but they are difficult to distinguish in the field. They are also relatively uncommon, and may need to be pooled with other species in order to obtain a sound detection function model. To account for this, we want to estimate the density/abundance in the WHICEAS study area of all detections of sei, Bryde’s, fin whales together.</p>
<p>To handle this, we will follow all the steps taken for a multi-species pool, as discussed above. Additionally, in our <code>estimates</code> sub-list(s), we will specify (1) that multiple species should be included in the estimate, and (2) that the weighted <em>g(0)</em> estimates for each of the individual species should be averaged together:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="lta.html#cb28-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb28-2"><a href="lta.html#cb28-2"></a>  <span class="kw">list</span>(<span class="dt">spp =</span> <span class="kw">c</span>(<span class="st">&#39;072&#39;</span>, <span class="st">&#39;073&#39;</span>, <span class="st">&#39;099&#39;</span>, <span class="st">&#39;074&#39;</span>),</span>
<span id="cb28-3"><a href="lta.html#cb28-3"></a>       <span class="dt">title =</span> <span class="st">&quot;Sei/Bryde&#39;s/Fin whale&quot;</span>,</span>
<span id="cb28-4"><a href="lta.html#cb28-4"></a>       <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb28-5"><a href="lta.html#cb28-5"></a>       <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>,</span>
<span id="cb28-6"><a href="lta.html#cb28-6"></a>       <span class="dt">combine_g0 =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
</div>
<div id="rare-unidentified-taxa" class="section level4 unnumbered hasAnchor">
<h4>Rare unidentified taxa<a href="lta.html#rare-unidentified-taxa" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A similar problem occur when you have species codes for unidentified taxa that have been identified down to a family- or genus-level. For example, “Unidenfitied <em>Mesoplodon</em>” is a species code (the code is <code>"050"</code>) for any beaked whale that is definitely in the genus <em>Mesoplodon</em>. There are plenty of these sightings, which means <em>g(0)</em> and its CV can be estimated just fine without referring to other species codes.</p>
<p>Other unidentified taxa, however, are less common. For example, in Hawaiian studies, density/abundance is estimated for “Unidentified rorquals”. In the field there is a species code for this group, <code>"070"</code>, but it is rarely used – there are enough sightings to model the detection function, but not nearly enough sightings to estimate <em>g(0)</em> or its CV. In this case, we need to combine <em>g(0)</em> from more common species codes in order to estimate the unidentified rorqual’s <em>g(0)</em>.</p>
<p>To do this, we fit a detection function using species code <code>"070"</code> …</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="lta.html#cb29-1"></a>fit_filters &lt;-</span>
<span id="cb29-2"><a href="lta.html#cb29-2"></a><span class="st">    </span><span class="kw">list</span>(<span class="dt">spp =</span> <span class="kw">c</span>(<span class="st">&#39;070&#39;</span>),</span>
<span id="cb29-3"><a href="lta.html#cb29-3"></a>         <span class="dt">pool =</span> <span class="st">&#39;Unidentified rorqual&#39;</span>,</span>
<span id="cb29-4"><a href="lta.html#cb29-4"></a>         <span class="dt">cohort =</span> <span class="st">&#39;all&#39;</span>,</span>
<span id="cb29-5"><a href="lta.html#cb29-5"></a>         <span class="dt">truncation_distance =</span> <span class="fl">5.5</span>)</span></code></pre></div>
<p>… then, in our <code>estimates</code> list, we specify some alternate <code>g(0)</code> species designations.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="lta.html#cb30-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb30-2"><a href="lta.html#cb30-2"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;070&#39;</span>,</span>
<span id="cb30-3"><a href="lta.html#cb30-3"></a>         <span class="dt">title =</span> <span class="st">&#39;Unidentified rorqual&#39;</span>,</span>
<span id="cb30-4"><a href="lta.html#cb30-4"></a>         <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb30-5"><a href="lta.html#cb30-5"></a>         <span class="dt">regions =</span> <span class="st">&#39;WHICEAS&#39;</span>,</span>
<span id="cb30-6"><a href="lta.html#cb30-6"></a>         <span class="dt">alt_g0_spp =</span> <span class="kw">c</span>(<span class="st">&#39;071&#39;</span>,<span class="st">&#39;099&#39;</span>,<span class="st">&#39;074&#39;</span>,<span class="st">&#39;075&#39;</span>),</span>
<span id="cb30-7"><a href="lta.html#cb30-7"></a>         <span class="dt">combine_g0 =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="geostratum-combinations" class="section level3 unnumbered hasAnchor">
<h3>Geostratum combinations<a href="lta.html#geostratum-combinations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In your <code>estimates</code> sub-lists, the <code>regions</code> and <code>regions_remove</code> slots give you control of the geographic scope of (1) the weighted <em>g(0)</em> and CV used in density estimation, (2) the effort and sightings used to estimate density, (3) and the area used to calculate abundance.</p>
<div id="a-note-on-cohort-geostrata" class="section level4 unnumbered hasAnchor">
<h4>A note on cohort geostrata<a href="lta.html#a-note-on-cohort-geostrata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recall that, when processing your survey data to create a <code>cruz</code> object, you provide a list of geostrata as an argument in your <code>process_surveys()</code> call. You also have the option to specify a subset of those geostrata for each species cohort (see <code>load_cohort_settings()</code>), which is an option that you should almost always use. Selecting a subset of geostrata is important because that subset is used to “segmentize” your survey data – i.e., break effort into discrete sections that can be bootstrap-sampling during the <code>lta()</code> variance estimation routine – and the segmentizing procedure always breaks segments when a survey passes from one geostratum to another.</p>
<p>This matters because the <code>lta()</code> bootstrapping routine will re-sample survey segments in a way that preserves the proportion of segments occurring in each geostratum, to ensure that all geostrata are represented in the same proportion as the original estimate. When segments are unncessarily broken into small segments by irrelevant geostrata that have been included in the analysis, the bootstrap estimate of the CV is likely to be too large.</p>
<p>For example: in the Central North Pacific, there are about 11 geostrata commonly used. These include the Hawaiian EEZ geostratum, the Main Hawaiian Islands geostratum, and the larger CNP geostratum that represents the maximum range of the study area. These three geostrata are typically all you need for most density estimates for most species. However, a few species – e.g., bottlenose dolphin, pantropical spotted dolphin, and false killer whale – have special geostrata that represent insular stock boundaries and/or pelagic stock boundaries. If those insular geostrata are used in density estimates for which they do not apply, they will confound the bootstrap estimate of density/abundance CV. <strong>Punchline: be sure to specify only the relevant geostrata in each cohort’s settings.</strong></p>
</div>
<div id="combining-disparate-geostrata" class="section level4 unnumbered hasAnchor">
<h4>Combining disparate geostrata<a href="lta.html#combining-disparate-geostrata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For example, in Hawaii bottlenose dolphins belong to a pelagic stock as well as several insular stocks. If you wished to estimate the abundance of all insular stocks together, you simply provide their respective geostratum names in the <code>regions</code> slot of your <code>estimates</code> sub-list:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="lta.html#cb31-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;018&#39;</span>,</span>
<span id="cb31-2"><a href="lta.html#cb31-2"></a>                       <span class="dt">title =</span> <span class="st">&#39;Bottlenose dolphin&#39;</span>,</span>
<span id="cb31-3"><a href="lta.html#cb31-3"></a>                       <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb31-4"><a href="lta.html#cb31-4"></a>                       <span class="dt">regions =</span> <span class="kw">c</span>(<span class="st">&#39;Bottlenose_KaNi&#39;</span>,</span>
<span id="cb31-5"><a href="lta.html#cb31-5"></a>                                   <span class="st">&#39;Bottlenose_OUFI&#39;</span>,</span>
<span id="cb31-6"><a href="lta.html#cb31-6"></a>                                   <span class="st">&#39;Bottlenose_BI&#39;</span>)))</span></code></pre></div>
</div>
<div id="removing-insular-geostrata" class="section level4 unnumbered hasAnchor">
<h4>Removing insular geostrata<a href="lta.html#removing-insular-geostrata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Conversely, you may wish to estimate density/abundance for <em>pelagic</em> bottlenose dolphins only, ignoring the insular stocks. You can substract geostrata using the <code>regions_remove</code> slot:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="lta.html#cb32-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;018&#39;</span>,</span>
<span id="cb32-2"><a href="lta.html#cb32-2"></a>                       <span class="dt">title =</span> <span class="st">&#39;Bottlenose dolphin&#39;</span>,</span>
<span id="cb32-3"><a href="lta.html#cb32-3"></a>                       <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb32-4"><a href="lta.html#cb32-4"></a>                       <span class="dt">regions =</span> <span class="st">&#39;HI_EEZ&#39;</span>,</span>
<span id="cb32-5"><a href="lta.html#cb32-5"></a>                       <span class="dt">regions_remove =</span> <span class="kw">c</span>(<span class="st">&#39;Bottlenose_KaNi&#39;</span>,</span>
<span id="cb32-6"><a href="lta.html#cb32-6"></a>                                          <span class="st">&#39;Bottlenose_OUFI&#39;</span>,</span>
<span id="cb32-7"><a href="lta.html#cb32-7"></a>                                          <span class="st">&#39;Bottlenose_BI&#39;</span>)))</span></code></pre></div>
</div>
<div id="combine-partially-overlapping-geostrata" class="section level4 unnumbered hasAnchor">
<h4>Combine partially overlapping geostrata<a href="lta.html#combine-partially-overlapping-geostrata" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Say you want to estimate the density/abundance for a set of geostrata that partially overlap. An example of this is that the Northwest Hawaiian Islands geostratum overlaps slightly with the Main Hawaiian Islands geostratum. This is not an issue; when study area is calculated within <code>lta()</code> (actually, that function calls another function, <code>strata_area()</code>, to do this. That function is demonstrated below), overlap among strata is accounted for.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="lta.html#cb33-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;018&#39;</span>,</span>
<span id="cb33-2"><a href="lta.html#cb33-2"></a>                       <span class="dt">title =</span> <span class="st">&#39;Bottlenose dolphin&#39;</span>,</span>
<span id="cb33-3"><a href="lta.html#cb33-3"></a>                       <span class="dt">years =</span> <span class="dv">2017</span>,</span>
<span id="cb33-4"><a href="lta.html#cb33-4"></a>                       <span class="dt">regions =</span> <span class="kw">c</span>(<span class="st">&#39;MHI&#39;</span>,<span class="st">&#39;NWHI&#39;</span>)))</span></code></pre></div>
</div>
<div id="regionally-stratified-analysis" class="section level4 unnumbered hasAnchor">
<h4>Regionally stratified analysis<a href="lta.html#regionally-stratified-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Field surveys are sometimes stratified such that trackline design and/or density can differ substantially across regions. Also, analysts may sometimes wish to estimate density/abundance for individual regions separately, regardless of design stratification.</p>
<p>In <code>lta()</code>, you can accommodate a stratified analysis by providing an <code>estimates</code> sub-list for each geostratum. For example, in 2002 the Hawaiian EEZ was surveyed with different effort intensity in the Main Hawaiian Islands region compared to pelagic waters. For that reason, density/abundance estimates ought to be stratified by region:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="lta.html#cb34-1"></a>estimates &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb34-2"><a href="lta.html#cb34-2"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;013&#39;</span>,</span>
<span id="cb34-3"><a href="lta.html#cb34-3"></a>         <span class="dt">title =</span> <span class="st">&#39;Striped dolphin&#39;</span>,</span>
<span id="cb34-4"><a href="lta.html#cb34-4"></a>         <span class="dt">years =</span> <span class="dv">2002</span>,</span>
<span id="cb34-5"><a href="lta.html#cb34-5"></a>         <span class="dt">regions =</span> <span class="st">&#39;MHI&#39;</span>),</span>
<span id="cb34-6"><a href="lta.html#cb34-6"></a>    <span class="kw">list</span>(<span class="dt">spp =</span> <span class="st">&#39;013&#39;</span>,</span>
<span id="cb34-7"><a href="lta.html#cb34-7"></a>         <span class="dt">title =</span> <span class="st">&#39;Striped dolphin&#39;</span>,</span>
<span id="cb34-8"><a href="lta.html#cb34-8"></a>         <span class="dt">years =</span> <span class="dv">2002</span>,</span>
<span id="cb34-9"><a href="lta.html#cb34-9"></a>         <span class="dt">regions =</span> <span class="st">&#39;HI_EEZ&#39;</span>,</span>
<span id="cb34-10"><a href="lta.html#cb34-10"></a>         <span class="dt">regions_remove =</span> <span class="st">&#39;MHI&#39;</span>))</span></code></pre></div>
<p>Here we have one 2002 estimate for the Main Hawaiian Islands, and a second for the pelagic Hawiian EEZ, achieved by subtracting the <code>"MHI"</code> stratum from the <code>"HI_EEZ"</code> stratum.</p>
<p>Once <code>lta()</code> processing is complete, you can summarize and plot the results for each study area separately. The next step is to combine the stratified estimates to generate a grand estimate for the entire EEZ. This is achieved using the <code>LTabundR</code> functions <code>lta_enlist()</code> and <code>lta_destratify()</code>. We discuss this further in a later chapter.</p>
</div>
</div>
<div id="subgroup-based-analyses" class="section level3 unnumbered hasAnchor">
<h3>Subgroup-based analyses<a href="lta.html#subgroup-based-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After 2010, Pacific Islands Fisheries Science Center (PIFSC) began a sub-group protocol referred to as the “PC Protocol” after the scientific name for false killer whales, <em>Pseudorca crassidens</em>, which was the species for which the protocol was designed.</p>
<p>False killer whales are rare and occur in dispersed subgroups, which complicates conventional distance sampling approaches to line-transect analysis.</p>
<p>To handle this, a separate, <em>subgroup-based</em> analytical approach was developed in 2014 - 2017. This approach could theoretically be used for other species that occur in subgroups. We cover this on a separate page.</p>
</div>
<div id="other-scenarios" class="section level3 unnumbered hasAnchor">
<h3>Other scenarios<a href="lta.html#other-scenarios" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Study periods that span years, such as a December - January survey. This is not yet handled well within the <code>LTabundR</code> framework.</p></li>
<li><p>More will go here.</p></li>
</ul>
</div>
</div>
<div id="behind-the-scenes-1" class="section level2 unnumbered hasAnchor">
<h2>Behind the scenes<a href="lta.html#behind-the-scenes-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="area-estimation" class="section level3 unnumbered hasAnchor">
<h3>Area estimation<a href="lta.html#area-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unless you manually specify the study area in your <code>estimates</code> list, <code>lta()</code> will calculate your study area for you based on the geostrata you provide. It does so by calling the <code>LTabundR</code> function <code>strata_area()</code>, which you can use on your own to explore geostratum combination options. This function was designed using the <code>sf</code> package to handle complex polygon combinations, and it uses Natural Earth datasets to remove land within your study area (this is a feature you can turn off, if you want).</p>
<p>Here are some examples of how <code>strata_area()</code> handles complex scenarios.</p>
<p>Say you want to estimate abundance in the ‘WHCEAS’ study area, but you want to make sure the study area estimate is accurately removing land:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="lta.html#cb35-1"></a>demo &lt;-<span class="st"> </span><span class="kw">strata_area</span>(<span class="dt">strata_all =</span> cruz<span class="op">$</span>settings<span class="op">$</span>strata,</span>
<span id="cb35-2"><a href="lta.html#cb35-2"></a>                    <span class="dt">strata_keep =</span> <span class="kw">c</span>(<span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb35-3"><a href="lta.html#cb35-3"></a>                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Say you want to estimate abundance in the pelagic Hawaiian EEZ, ignoring effort and sightings within the Main Hawaiian Islands stratum and accurately removing small islands in northwest Hawaii:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="lta.html#cb36-1"></a>demo &lt;-<span class="st"> </span><span class="kw">strata_area</span>(<span class="dt">strata_all =</span> cruz<span class="op">$</span>settings<span class="op">$</span>strata,</span>
<span id="cb36-2"><a href="lta.html#cb36-2"></a>                    <span class="dt">strata_keep =</span> <span class="kw">c</span>(<span class="st">&#39;HI_EEZ&#39;</span>),</span>
<span id="cb36-3"><a href="lta.html#cb36-3"></a>                    <span class="dt">strata_remove =</span> <span class="kw">c</span>(<span class="st">&#39;MHI&#39;</span>),</span>
<span id="cb36-4"><a href="lta.html#cb36-4"></a>                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Say you want to estimate abundance of pelagic bottlenose dolphins within the WHICEAS study area, ignoring the insular stocks:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="lta.html#cb37-1"></a>demo &lt;-<span class="st"> </span><span class="kw">strata_area</span>(<span class="dt">strata_all =</span> cruz<span class="op">$</span>settings<span class="op">$</span>strata,</span>
<span id="cb37-2"><a href="lta.html#cb37-2"></a>                    <span class="dt">strata_keep =</span> <span class="kw">c</span>(<span class="st">&#39;WHICEAS&#39;</span>),</span>
<span id="cb37-3"><a href="lta.html#cb37-3"></a>                    <span class="dt">strata_remove =</span> <span class="kw">c</span>(<span class="st">&#39;Bottlenose_KaNi&#39;</span>,<span class="st">&#39;Bottlenose_OUFI&#39;</span>,<span class="st">&#39;Bottlenose_BI&#39;</span>),</span>
<span id="cb37-4"><a href="lta.html#cb37-4"></a>                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Say you want to estimate abundance for <em>only</em> the insular bottlenose stocks:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="lta.html#cb38-1"></a>demo &lt;-<span class="st"> </span><span class="kw">strata_area</span>(<span class="dt">strata_all =</span> cruz<span class="op">$</span>settings<span class="op">$</span>strata,</span>
<span id="cb38-2"><a href="lta.html#cb38-2"></a>                    <span class="dt">strata_keep =</span> <span class="kw">c</span>(<span class="st">&#39;Bottlenose_KaNi&#39;</span>,<span class="st">&#39;Bottlenose_OUFI&#39;</span>,<span class="st">&#39;Bottlenose_BI&#39;</span>),</span>
<span id="cb38-3"><a href="lta.html#cb38-3"></a>                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Say you want to estimate abundance for false killer whales within the Northwest Hawaiian Islands and Main Hawaiian Islands study areas combined, but those geostrata partially overlap:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="lta.html#cb39-1"></a>demo &lt;-<span class="st"> </span><span class="kw">strata_area</span>(<span class="dt">strata_all =</span> cruz<span class="op">$</span>settings<span class="op">$</span>strata,</span>
<span id="cb39-2"><a href="lta.html#cb39-2"></a>                    <span class="dt">strata_keep =</span> <span class="kw">c</span>(<span class="st">&#39;MHI&#39;</span>,<span class="st">&#39;NWHI&#39;</span>),</span>
<span id="cb39-3"><a href="lta.html#cb39-3"></a>                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Say you want to estimate abundance for the Hawaiian EEZ <em>outside</em> of those partially overlapping geostrata:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="lta.html#cb40-1"></a>demo &lt;-<span class="st"> </span><span class="kw">strata_area</span>(<span class="dt">strata_all =</span> cruz<span class="op">$</span>settings<span class="op">$</span>strata,</span>
<span id="cb40-2"><a href="lta.html#cb40-2"></a>                    <span class="dt">strata_keep =</span> <span class="st">&#39;HI_EEZ&#39;</span>,</span>
<span id="cb40-3"><a href="lta.html#cb40-3"></a>                    <span class="dt">strata_remove =</span> <span class="kw">c</span>(<span class="st">&#39;MHI&#39;</span>,<span class="st">&#39;NWHI&#39;</span>),</span>
<span id="cb40-4"><a href="lta.html#cb40-4"></a>                    <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="g0-estimation" class="section level3 unnumbered hasAnchor">
<h3><em>g(0)</em> estimation<a href="lta.html#g0-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you want <code>lta()</code> to calculate a weighted <em>g(0)</em> estimate (and associated CV) that is specific to the conditions associated with your <code>estimates</code> sub-list parameters, all you need to do is provide the <code>Rg0</code> input. When you do this, the <code>lta()</code> function will find the <code>Rg0</code> values associated with the species code(s) in your <code>estimates</code> sub-list, then calculate weighted <em>g(0)</em> and its CV using the <code>LTabundR</code> function, <code>g0_weighted()</code>, which we discussed and demonstrated on the previous page.</p>
<p>If <code>lta()</code> can’t find your species code in the <code>Rg0</code> table you provide, it will give up and assume that <code>g(0)</code> is 1.0 and that <code>g0_cv</code> is 0.0.</p>
<p>If your <code>estimates</code> sub-list has a <code>alt_g0_spp</code> slot, <code>lta()</code> will use that species code instead to filter the <code>Rg0</code> table.</p>
<p>If your <code>estimates</code> sub-list has a <code>combine_g0</code> slot that is <code>TRUE</code>, <code>lta()</code> will filter the <code>Rg0</code> table using all species codes you provide. If that filtration results in multiple <code>Rg0</code> species being found, weighted <em>g(0)</em> will be calculated for each of those species separately, then those <em>g(0)</em> estimates will be combined using a geometric mean (using the <code>LTabundR</code> function <code>g0_combine()</code>). If <code>combine_g0</code> is <code>FALSE</code>, only the first species code provided in your <code>estimates</code> sub-list will be used to filter <code>Rg0</code>.</p>
<p>If you want to supply a weighted <em>g(0)</em> estimate and its CV yourself, you can add the <code>g0</code> and <code>g0_cv</code> slots to your <code>estlimates</code> sublist, as explained above.</p>
<p>If you want to coerce <em>g(0)</em> to be assumed to be 1.0 (with CV = 0.0), you can either (1) <em>not</em> supply the <code>Rg0</code> input, or (2) manually specify the <code>g0</code> and <code>g0_cv</code> slots in your <code>estimates</code> sub-list accordingly.</p>
</div>
<div id="covariates-in-detection-function-estimation" class="section level3 unnumbered hasAnchor">
<h3>Covariates in detection function estimation<a href="lta.html#covariates-in-detection-function-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before detection functions are modelled, any covariates supplied by the user and specified as a factor are first tested for eligibility. Only factors with at least two levels (or whatever you specified with <code>df_settings$covariates_levels</code>) and 10 observations in each level (or whatever you specified with <code>df_settings$covariates_n_per_level</code>) are eligible for inclusion.</p>
</div>
<div id="fitting-a-detection-function" class="section level3 unnumbered hasAnchor">
<h3>Fitting a detection function<a href="lta.html#fitting-a-detection-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The detection function is estimated using functions in the package <code>mrds</code>, primarily the main function <code>mrds::ddf()</code>, which uses a Horvitz-Thompson-like estimator to predict the probability of detection for each sighting. If multiple base key functions (e.g., half-normal or hazard-rate) are provided, and/or if covariates are specified, model fitting is done in a forward stepwise procedure:</p>
<ul>
<li><font size="-1">In the first round, the base model (no covariates, i.e., <code>"~1"</code>) is fit first.<br />
</li>
<li>In the second round, each covariate is added one at a time; at the end of the round, the covariate, if any, that produces the lowest AIC below the AIC from the previous round is added to the formula.<br />
</li>
<li>This process is repeated in subsequent rounds, adding a new covariate term in each round, until the AIC no longer improves.</li>
<li>If a second base key is provided, the process is repeated for that second key.</font></li>
</ul>
<p>All models within <code>delta_aic</code> of the model with the lowest AIC qualify as best-fitting models. The best-fitting model(s) is(are) then used to estimate the Effective Strip half-Width (ESW) based on the covariates associated with each sighting.</p>
<p>If multiple best-fitting models occur, we will find the average ESW for each sighting across all models, using a weighted mean approach in which we weight according to model AIC. To turn off this model averaging step, set <code>delta_aic</code> to <code>0</code> to avoid passing multiple models to the abundance estimation stage.</p>
<p>Note that if <code>LnSsTot</code> is included as a covariate, the function will (1) check to see if the <code>sightings</code> dataframe has a column named <code>ss_valid</code> (all <code>cruz</code> objects do), then, if so, (2) filter <code>sightings</code> only to rows where <code>ss_valid</code> is <code>TRUE</code>, meaning the school size estimate for that sighting is a valid estimate.</p>
<p>This stage of the <code>lta()</code> command is executed within a backend function, <code>LTabundR::fit_df()</code>, which has its own documentation for your reference.</p>
</div>
<div id="estimating-density-abundance" class="section level3 unnumbered hasAnchor">
<h3>Estimating density &amp; abundance<a href="lta.html#estimating-density-abundance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Estimates are produced for various combinations of species, regions, and years, according to the arguments specified in your <code>estimates</code> list(s). Before these estimates are produced, we filter the data used to fit the detection function to strictly systematic (design-based) effort (i.e., <code>EffType = "S"</code>), in which standard protocols are in use (i.e., <code>OnEffort = TRUE</code>) and the Beaufort sea state is less than 7 (though these controls can be modified using the <code>lta()</code> inputs <code>abund_eff_types</code> and <code>abund_bft_range</code> (see above).</p>
<p>Note that if <code>sightings</code> has a column named <code>ss_valid</code> (all standard <code>cruz</code> objects do) and any of the rows in that column are <code>FALSE</code>, those rows will have their <code>best</code> school size estimate (which will be <code>NA</code> or <code>1</code>, since they are invalid) replaced by the mean best estimate for their respective species.</p>
<p>This stage of the <code>lta()</code> command is executed within a back-end function, <code>LTabundR::abundance()</code>, which has its own documentation for your reference.</p>
</div>
<div id="bootstrap-variance-estimation" class="section level3 unnumbered hasAnchor">
<h3>Bootstrap variance estimation<a href="lta.html#bootstrap-variance-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If the <code>bootstraps</code> input value is greater than 1, bootstrap variance estimation will be attempted. In each bootstrap iteration, survey segments are re-sampled with replacement before fitting the detection function and estimating density/abundance. Re-sampling is done in a routine that preserves the proportion of segments from each geostratum.</p>
<p>Note that the entire process is repeated in each bootstrap: step-wise fitting of the detection function, averaging of the best-fitting models, and density/abundance estimation for all species/region/year combinations specified in your <code>estimates</code> input. At the end of the bootstrap process, results are summarized for each species/region/year combination. 95% confidence intervals are calculated using the BCA method (package <code>coxed</code>, function <code>bca()</code>).</p>
</div>
<div id="g0-values-during-bootstrapping" class="section level3 unnumbered hasAnchor">
<h3><code>g(0)</code> values during bootstrapping<a href="lta.html#g0-values-during-bootstrapping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When conducting the non-parametric bootstrap routine to estimate the CV of density and abundance, uncertainty is incorporated into the g(0) value in each iteration using a parametric bootstrapping subroutine: First, a logit-transformed distribution is modeled based upon the mean and CV of g(0) provided by the user in the <code>estimates</code> input (see documentation for <code>LTabundR::g0_optimize()</code> for details on this step). This modeled distribution is used to randomly draw a g(0) value for each iteration of the density/abundance bootstrap routine. In this way, the uncertainty in g(0) is propagated into uncertainty in density/abundance.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="g0.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="destratify.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/emk-noaa/emk-noaa.github.io07-lta.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["vignette.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
