<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 8 Multi-stock LTA | vignette</title>
  <meta name="description" content=" 8 Multi-stock LTA | vignette" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content=" 8 Multi-stock LTA | vignette" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content=" 8 Multi-stock LTA | vignette" />
  <meta name="github-repo" content="emk-noaa/emk-noaa.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 8 Multi-stock LTA | vignette" />
  
  <meta name="twitter:description" content=" 8 Multi-stock LTA | vignette" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lta.html"/>
<link rel="next" href="g0.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.22/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">WinCruz analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Status<span></span></a></li>
<li class="part"><span><b>I Tutorial<span></span></b></span></li>
<li class="chapter" data-level="2" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>2</b> Install <code>LTabundR</code><span></span></a><ul>
<li><a href="install.html#option-1-install-from-github">Option 1: Install from GitHub<span></span></a></li>
<li><a href="install.html#option-2-install-locally">Option 2: Install locally<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="settings.html"><a href="settings.html"><i class="fa fa-check"></i><b>3</b> Settings<span></span></a><ul>
<li><a href="settings.html#survey-strata">Survey strata<span></span></a></li>
<li><a href="settings.html#study-area-polygon">Study area polygon<span></span></a></li>
<li><a href="settings.html#survey-wide-settings">Survey-wide settings<span></span></a></li>
<li><a href="settings.html#cohort-specific-settings">Cohort-specific settings<span></span></a></li>
<li><a href="settings.html#example-code">Example code<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>4</b> Data processing<span></span></a><ul>
<li><a href="processing.html#behind-the-scenes">Behind the scenes<span></span></a></li>
<li><a href="processing.html#review">Review<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>5</b> Maps<span></span></a><ul>
<li><a href="maps.html#publishable-maps">Publishable maps<span></span></a></li>
<li><a href="maps.html#interactive-maps">Interactive maps<span></span></a></li>
<li><a href="maps.html#interactive-dashboard">Interactive dashboard<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="summarize.html"><a href="summarize.html"><i class="fa fa-check"></i><b>6</b> Summarize survey<span></span></a><ul>
<li><a href="summarize.html#summarize-effort">Summarize effort<span></span></a></li>
<li><a href="summarize.html#summarize-by-beaufort">Summarize by Beaufort<span></span></a></li>
<li><a href="summarize.html#summarize-sightings">Summarize sightings<span></span></a></li>
<li><a href="summarize.html#summarize-certain-species">Summarize certain species<span></span></a></li>
<li><a href="summarize.html#cruz_explorer"><code>cruz_explorer()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="lta.html"><a href="lta.html"><i class="fa fa-check"></i><b>7</b> Line-transect analysis<span></span></a><ul>
<li><a href="lta.html#inputs-1">Inputs<span></span></a></li>
<li><a href="lta.html#variance-estimation">Variance estimation<span></span></a></li>
<li><a href="lta.html#other-inputs">Other inputs<span></span></a></li>
<li><a href="lta.html#lta-output"><code>lta()</code> output<span></span></a></li>
<li><a href="lta.html#behind-the-scenes-1">Behind the scenes<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multistock.html"><a href="multistock.html"><i class="fa fa-check"></i><b>8</b> Multi-stock LTA<span></span></a><ul>
<li><a href="multistock.html#setup-your-googlesheet">Setup your <em>GoogleSheet</em><span></span></a></li>
<li><a href="multistock.html#run-it">Run it<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="g0.html"><a href="g0.html"><i class="fa fa-check"></i><b>9</b> Estimating g(0)<span></span></a><ul>
<li><a href="g0.html#relative-g0">Relative <code>g(0)</code><span></span></a></li>
<li><a href="g0.html#weighted-average-g0">Weighted average <code>g(0)</code><span></span></a></li>
</ul></li>
<li class="part"><span><b>II Case studies<span></span></b></span></li>
<li class="chapter" data-level="10" data-path="casestudies.html"><a href="casestudies.html"><i class="fa fa-check"></i><b>10</b> Central North Pacific<span></span></a></li>
<li class="chapter" data-level="11" data-path="california-current-system.html"><a href="california-current-system.html"><i class="fa fa-check"></i><b>11</b> California Current System<span></span></a></li>
<li class="chapter" data-level="12" data-path="eastern-tropical-pacific.html"><a href="eastern-tropical-pacific.html"><i class="fa fa-check"></i><b>12</b> Eastern Tropical Pacific<span></span></a></li>
<li class="chapter" data-level="13" data-path="practicalities.html"><a href="practicalities.html"><i class="fa fa-check"></i><b>13</b> Practicalities<span></span></a></li>
<li class="part"><span><b>III Appendix<span></span></b></span></li>
<li class="chapter" data-level="14" data-path="stratagallery.html"><a href="stratagallery.html"><i class="fa fa-check"></i><b>14</b> Strata gallery<span></span></a><ul>
<li><a href="stratagallery.html#central-north-pacific">Central North Pacific<span></span></a></li>
<li><a href="stratagallery.html#california-current">California Current<span></span></a></li>
<li><a href="stratagallery.html#etp">ETP<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="segmentizing.html"><a href="segmentizing.html"><i class="fa fa-check"></i><b>15</b> Segmentizing<span></span></a><ul>
<li><a href="segmentizing.html#approach">Approach<span></span></a></li>
<li><a href="segmentizing.html#defaults-2">Defaults<span></span></a></li>
<li><a href="segmentizing.html#day-vs-equal-length">Day vs Equal Length<span></span></a></li>
<li><a href="segmentizing.html#contiguous-vs.-non-contiguous-effort">Contiguous vs. non-contiguous effort<span></span></a></li>
<li><a href="segmentizing.html#segment-remainder-handling">Segment remainder handling<span></span></a></li>
<li><a href="segmentizing.html#typical-settings">Typical settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="abund9_compare.html"><a href="abund9_compare.html"><i class="fa fa-check"></i><b>16</b> <code>LTabundR</code> vs. <code>ABUND9</code><span></span></a><ul>
<li><a href="abund9_compare.html#differences-in-total-effort">Differences in total effort<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-on-effort-distance">Differences in on-effort distance<span></span></a></li>
<li><a href="abund9_compare.html#differences-it-total-sightings">Differences it total sightings<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-on-effort-sightings">Differences in on-effort sightings<span></span></a></li>
<li><a href="abund9_compare.html#differences-in-school-size-estimation">Differences in school size estimation<span></span></a></li>
<li><a href="abund9_compare.html#processing-time">Processing time<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="misc_functions.html"><a href="misc_functions.html"><i class="fa fa-check"></i><b>17</b> Miscellaneous functions<span></span></a></li>
<li class="chapter" data-level="18" data-path="backlog.html"><a href="backlog.html"><i class="fa fa-check"></i><b>18</b> Appendix: Backlog<span></span></a></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/emk-noaa/emk-noaa.github.io" target="blank">Eric & Amanda</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">vignette</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multistock" class="section level1 hasAnchor">
<h1><span class="header-section-number"> 8</span> Multi-stock LTA<a href="multistock.html#multistock" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In a relatively small study focused on only a few species, the <code>lta()</code> function
will suffice for completing your analysis. However, some studies cover dozens of species
across multiple years, and analyses are often updated every year or so. In such complex and repetitive muilti-stock analyses, a more efficient option is to use the <code>lta_multistock()</code> function.</p>
<p>This function allows you to use a <em>GoogleSheet</em> to parameterize density/abundance estimates for many species at once. You can then conduct all analyses with a single function call.</p>
<div id="setup-your-googlesheet" class="section level2 unnumbered hasAnchor">
<h2>Setup your <em>GoogleSheet</em><a href="multistock.html#setup-your-googlesheet" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The key to using this function is setting up your GoogleSheet correctly.
See an example <a href="https://docs.google.com/spreadsheets/d/15uLleqIqoRKFRrnNttMcJx-Q_i7BfuepuUfOOjEP7Dw/edit?usp=sharing">here</a>. This example <em>GoogleSheet</em> is set up to estimate the density/abundance of about 20 species in the Central North Pacific in the years 2010 and 2017.</p>
<p>When building up your own <em>GoogleSheet</em>, we recommend copying the file above as a template, then customizing according to your needs. <strong>Note:</strong> Be sure to change “Share” settings to ‘Anyone can view’, and then copy the share link.</p>
<p>This GoogleSheet needs to have the following sheets (they can occur in any order):</p>
<ul>
<li><p><strong><code>"species"</code></strong> A table of species codes and related names (common, scientific, etc.).
Crucially, this table has a column, <code>"cohort"</code>, that specifies which cohort each species belongs to.
Recall from the <code>process_surveys()</code> documentation that a cohort is a group of species
for which survey data are processed in a common way. Typically, most species belong
to a majority cohort (in the GoogleSheet example above, this cohort is named “most”),
with only a few exceptions (if any) in a separate cohort.</p></li>
<li><p><strong><code>"ships"</code></strong> A table with the ship associated with each cruise number.</p></li>
<li><p><strong><code>"process_surveys"</code></strong> Survey-specific settings, used to process <code>DAS</code> data and produce a <code>cruz</code> object. These settings are explained in <code>?load_survey_settings()</code>.</p></li>
<li><p><strong><code>"process_cohorts"</code></strong> Cohort-specific settings. These settings are explained in <code>?load_cohort_settings()</code>.</p></li>
<li><p><strong><code>"species_pools"</code></strong> A table defining species pools for line-transect analysis.
A species pool is a group of species that share detection qualities, therefore their
sightings are pooled together to estimate a detection function. This can be useful for
uncommon or cryptic species with few sightings. Common species with a sufficient number
of sightings will typically be alone in their own dedicated species pool.
Each pool needs a <code>"title"</code>, a vector of species codes that belong to the pool, and
values for filtering data for fitting the detection function. See details for
these arguments in the <code>fit_filters</code> input for the function <code>?lta()</code>.</p></li>
<li><p><strong><code>"LTA"</code></strong> Settings to specify how line-transect analysis will proceed,
including which covariates to use when fitting a detection function,
how many bootstrap iterations to use (if any) to estimate variance, etc.
See details for these arguments in the documentation for <code>?lta()</code>.</p></li>
<li><p><strong><code>"estimates"</code></strong> This will typically be the largest and most complex table
in your GoogleSheet. It has a row for every density/abundance estimate that you want.
The columns represent settings for each estimate (these are detailed in the
<code>estimates</code> input for <code>?lta()</code>). Note the first column, <code>"run"</code>, which you can
use to ignore certain rows while you develop your analysis. Any row in which <code>"run"</code> is <code>1</code> will
be attempted, any row in which <code>"run"</code> is <code>0</code> or empty will be ignored.</p></li>
</ul>
</div>
<div id="run-it" class="section level2 unnumbered hasAnchor">
<h2>Run it<a href="multistock.html#run-it" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="multistock.html#cb90-1"></a><span class="co"># Bring in processed survey data</span></span>
<span id="cb90-2"><a href="multistock.html#cb90-2"></a><span class="kw">data</span>(<span class="st">&quot;cnp_1986_2020_150km&quot;</span>)</span>
<span id="cb90-3"><a href="multistock.html#cb90-3"></a></span>
<span id="cb90-4"><a href="multistock.html#cb90-4"></a><span class="co"># Save GoogleSheet URL</span></span>
<span id="cb90-5"><a href="multistock.html#cb90-5"></a>url &lt;-<span class="st"> &#39;https://docs.google.com/spreadsheets/d/15uLleqIqoRKFRrnNttMcJx-Q_i7BfuepuUfOOjEP7Dw/edit?usp=sharing&#39;</span></span>
<span id="cb90-6"><a href="multistock.html#cb90-6"></a><span class="co"># Run it</span></span>
<span id="cb90-7"><a href="multistock.html#cb90-7"></a>mr &lt;-<span class="st"> </span><span class="kw">lta_multistock</span>(<span class="dt">cruz =</span> cnp_<span class="dv">1986</span>_<span class="dv">2020</span>_150km,</span>
<span id="cb90-8"><a href="multistock.html#cb90-8"></a>                     <span class="dt">source_path =</span> url)</span></code></pre></div>
<p>The <code>lta_multistock()</code> function returns a list with a slot containing <code>lta()</code> output for each “species pool”. See documentation for <code>?lta()</code> for details on the contents of each slot.</p>
<p>Note that as <code>lta_multistock()</code> works, it will produce tables that allow you to check estimates as they are produced. After the analysis for each species pool is completed, <code>lta_report()</code> will be run on the results to update these summary tables. See details for <code>?lta_report</code> for details.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lta.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="g0.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/emk-noaa/emk-noaa.github.io07-multistock-lta.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["vignette.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
