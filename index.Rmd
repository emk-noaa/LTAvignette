--- 
title: vignette
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: emk-noaa/emk-noaa.github.io
description: "vignette"
always_allow_html: true
---


```{r setup, include=FALSE, echo = FALSE}
# Basic knitr options
library(knitr)
opts_chunk$set(comment = NA, 
               echo=FALSE,
               warning = FALSE, 
               message = FALSE, 
               error = TRUE, 
               cache = FALSE,
               fig.width = 9.64,
               fig.height = 5.9,
               fig.path = 'figures/')
options(scipen=999)

```


# Status

This status report outlines the code we are developing to process `WinCruz` data and prepare it for density estimation analysis using `distance` and related packages in `R`.  

#### Recent changes {-}

- Added a new survey-wide setting, `out_handling`, that determines how data occurring outside of geographic strata will be handled. Currently the two options are `"remove"` (the default), which removes data occurring outside of the strata (speeds things up, reduces memory needs), and `"stratum"`, which assigns all exterior events to an `"out"` stratum.  

- Modified `segmentize()` function so that a list of segments is not returned to the user; that feature was created enormous objects (> 1 GB for the 1986 - 2020 CNP DAS data) and is not useful enough to retain as a standing slot. A list like that can be easily produced using a `dplyr` pipe (`group_by(seg_id) %>% group_split()`) when the need arises (e.g., in `map_effort()` -- this function has also been updated to accommodate this new change).  

- Fixed minutiae regarding group size estimation: sightings with missing data are given a school size estimate of 1, as done in `ABUND`; geometric mean functions have been fixed.

- Added progress indicator to `process_sightings()`.  

- New `format_distance()` function creates tables that match `EFFORT.csv` and `SIGHTINGS.csv`.  (See [here](#df).)  

- New `process_surveys()` function provides a wrapper for all data processing functions in a single command. This will be the main function that researchers use to process their data. All other functions are called *within* this function, and will rarely be called directly by researchers except in special analyses. This is explained at the top of the page on [Data Processing](#processing). This function includes an option for saving the result locally as a `RData` file, which allows the user to run this function once and save the result for later sessions. 

- New helper function, `read_polygon()`, reads a `DAT` file of polygon coordinates and converts it to a dataframe compatible with `LTabundR` functions.  Can handle files with multiple polygons.  

- Skeletonized new summary functions (see the [Summarize page](#summarize)).      

- Ship name is now added to all dataframes.  

- New `process_sightings()` function, with code for calibrating group sizes according to user-provided coefficient tables (mirroring `ABUND9` with slight mods, e.g., school size threshold for observers not in the `Coeff.DAT` file.). (Details: the function `process_sightings()` relies upon a utility function, `group_size()`, which in turn relies upon `group_size_calibrate()`.)

- Added cohort-specific setting, `school_size_calibrate`, that allows researchers to specify whether a cohort should or should not have school sizes calibrated. Example use case: `school_size_calibrate = TRUE` for a cohort of dolphin species, but make it `FALSE` for a cohort of large baleen whales.  

- Basic function for mapping sightings (QA/QC): `map_sightings()`.  

- Added detail/polish to vignette pages on [Settings](#settings), [Processing Data](#processing), and the [Appendix on Segmentizing](#segmentizing). I believe these are ready for close review.    

- Added detailed comments to code for all functions to date.  


#### Next focus {-}

- Review INP files shared by Amanda 

- EFFORT and SIGHTINGS outputs / stage for distance

- Survey summary   

- Efficient system for testing on various datasets 

- Document function manuals   

 

#### Questions for Amanda {-}

- FKW handling

- What is the ship list used for?   




