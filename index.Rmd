--- 
title: User's guide for `LTabundR`
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: emk-noaa/emk-noaa.github.io
description: "vignette"
always_allow_html: true
---


```{r setup, include=FALSE, echo = FALSE}
# Basic knitr options
library(knitr)
opts_chunk$set(comment = NA, 
               echo=FALSE,
               warning = FALSE, 
               message = FALSE, 
               error = TRUE, 
               cache = FALSE,
               fig.width = 9.64,
               fig.height = 5.9,
               fig.path = 'figures/')
options(scipen=999)

```


# Overview {-} 

The `R` package `LTabundR` offers tools that facilitate and standardize design-based line-transect abundance estimation of cetaceans, based on typical workflow used following NOAA Fisheries ship surveys in the central and eastern Pacific (e.g., [Barlow 2006](https://www.google.com/url?q=https://onlinelibrary.wiley.com/doi/10.1111/j.1748-7692.2006.00032.x&sa=D&source=docs&ust=1676392605333708&usg=AOvVaw07ERYd9m2kJg0LttBFVyil), [Barlow and Forney 2007](https://spo.nmfs.noaa.gov/content/abundance-and-population-density-cetaceans-california-current-ecosystem), [Bradford et al. 2017](https://spo.nmfs.noaa.gov/content/fishery-bulletin/abundance-estimates-cetaceans-line-transect-survey-within-us-hawaiian), [Bradford et al. 2021](https://repository.library.noaa.gov/view/noaa/29004)).

That workflow typically involves four stages: 

**(1) Data processing**  

- This step involves reading in & processing raw `DAS` files (the files produced by the software `Wincruz` commonly used during NOAA Fisheries line-transect surveys in the Pacific), breaking effort into discrete segments for variance estimation, correcting group size estimates according to calibration models, and then averaging together group size estimates for each sighting.  

- Most importantly, this step standardizes the data structure in a way that all downstream analyses depend upon. The name we will use for this standardized data object is a `cruz` object.

- The key `LTabundR` functions you will use in this stage are `load_settings()` and `process_surveys()`. 


**(2) Data exploration**

- This step involves summarizing effort and sightings totals, determining the appropriate truncation distances for each species -- or pool of species -- based on sample sizes, and producing maps.  

- The key `LTabundR` functions in this stage are `cruz_explorer()` (a `Shiny` dashboard for data exploration) and the `summarize...`  functions, such as `summarize_species()` and `summarize_effort()`.


**(3) Data analysis**

- This step involves estimating Beaufort-specific "relative" trackline detection probabilities -- i.e., *g(0)* estimates; estimating density/abundance with detection functions and determining the CV of that estimate; handling stratified analyses; and evaluating if random variation in the encounter rate of a species may be driving differences in abundance estimates over time.  

- The key `LTabundR` functions in this stage are `g0_table()` and `lta()`.  

- Most analyses are group-based analyses, but false killer whales (*Pseudorca crassidens*) are analyzed differently using a subgroup-based approach. For this exception, the function `lta_subgroup()` will be used.  


**(4) Reports & plots**

- This step produces summary tables of the processed data and line-transect estimates; plots the best-fitting detection function model(s); and plots species-specific abundance estimates (and their CV).  

- They key `LTabundR` functions in this stage are `lta_report()`, `df_plot()`, and `lta_plot()`. 
 
This user's guide is structured around these four workflow stages. Those pages are followed by a set of case studies with full-fledged example code. The guide concludes with appendices that offer further details and minutiae on certain aspects of the package. 

Throughout this user's guide, we will primarily be using example data from the winter [Hawaiian Islands Cetacean Ecosystem and Assessment Survey (WHICEAS)](https://repository.library.noaa.gov/view/noaa/47788) of 2020, along with the summer-fall HICEAS 2017 data collected within the WHICEAS study area. 

### Installation {-} 

**Note: `BETA` testing only.** This package is currently in `beta` testing and is not yet ready for widespread use.

The `LTabundR` package is available on `GitHub` [here](https://github.com/PIFSC-Protected-Species-Division/LTabundR).  To install directly within `R`, use the following code:  

```{r, echo=TRUE, eval=FALSE, include=TRUE}
# Install 'devtools' package, if needed
if (!require('devtools')) install.packages('devtools')

# Increase timeout for download, since there are datasets
options(timeout=9999999)

# Install LTabundR remotely from GitHub
devtools::install_github('PIFSC-Protected-Species-Division/LTabundR')
```

```{r, echo=TRUE, eval=TRUE, include=TRUE, warning=FALSE}
# Load into session
library(LTabundR)
```

Note that this package contains large built-in datasets and may take several minutes to install.

### Credits {-}  

This `R` package is a consolidation of code developed over many years by many NOAA Fisheries scientists, primarily Jay Barlow, Tim Gerrodette, Jeff Laake, Karin Forney, Amanda Bradford, and Jeff Moore. This package was developed by Eric Keen and Amanda Bradford with support from the [NOAA Fisheries National Protected Species Toolbox Initiative](https://www.fisheries.noaa.gov/national/population-assessments/national-protected-species-toolbox-initiative). 
 
